{"version":3,"sources":["TimeChart.jsx","index.jsx"],"names":["buildScales","data","svgWidth","svgHeight","margin","d3","domain","d","range","left","right","bottom","top","formatDate","formatPercent","withStreamlitConnection","props","useState","window","innerWidth","setWidth","setHeight","Streamlit","setFrameHeight","axis_font_size","legend_font_size","circleRadius","args","map","Date","split","parseFloat","svgRef","useRef","tooltipHtml","xScale","pos_yScale","active_yScale","useEffect","current","style","addEventListener","svgElement","append","classed","select","call","g","attr","transition","duration","ticks","tickFormat","tickSize","tickSizeOuter","selectAll","keys","color","join","enter","i","parseInt","el","update","text","x","nodes","getComputedTextLength","active_area","y0","y1","styles","area","active_line","y","line","pos_line","tooltip","on","html","tooltipLeft","pageX","tooltipTop","pageY","exit","dispatch","transitionMillisec","remove","className","ref","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"kSAibMA,EAAc,SAACC,EAAMC,EAAUC,EAAWC,GAY9C,MAAO,CAVQC,MACXC,OAAOD,IAAUJ,GAAM,SAACM,GAAD,OAAOA,EAAE,OAChCC,MAAM,CAACJ,EAAOK,KAAMP,EAAWE,EAAOM,QACvBL,MACXC,OAAO,CAAC,EAAGD,IAAOJ,GAAM,SAACM,GAAD,OAAOA,EAAE,QACjCC,MAAM,CAACL,EAAYC,EAAOO,OAAQP,EAAOQ,MAC3BP,MAClBC,OAAO,CAAC,EAAGD,IAAOJ,GAAM,SAACM,GAAD,OAAOA,EAAE,QACjCC,MAAM,CAACL,EAAYC,EAAOO,OAAQP,EAAOQ,QAMzCC,EAAaR,IAAc,YAC3BS,EAAgBT,IAAU,OAGjBU,eA9bG,SAACC,GAEjB,IACA,EAA8BC,mBAASC,OAAOC,YAA9C,mBAAOjB,EAAP,KAAiBkB,EAAjB,KACA,EAAgCH,mBAFd,IAEmCf,GAArD,mBAAOC,EAAP,KAAkBkB,EAAlB,KAEAC,IAAUC,eAAepB,GAGzB,IAAIqB,EAAc,UAAM,GAAG,EAAEtB,EAAS,IAApB,MACduB,EAAgB,UAAM,GAAG,EAAEvB,EAAS,IAApB,MACfwB,EAAe,KAAMxB,EAK1Bc,EAAMW,KAAK1B,KAAQe,EAAMW,KAAK1B,KAAK2B,KAAI,SAAArB,GAAC,MAAI,CAAC,IAAIsB,KAAqB,iBAARtB,EAAE,GAAiBA,EAAE,GAAGuB,MAAM,KAAK,GAAG,YAAcvB,EAAE,IAAKA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,OACnJ,IAAMN,EAAOe,EAAMW,KAAK1B,KAElBG,EAAS,CAAC,IAAO,GAAI,OAAU,GAAI,KAAQ,EAAE2B,WAAWP,GAAgB,EAAG,MAAS,EAAEO,WAAWP,IAEjGQ,EAASC,iBAAO,MAGhBC,EAAc,SAAC3B,GAMnB,MALU,6BACKM,EAAWN,EAAE,IADlB,gEAXM,UAWN,aAE0CA,EAAE,GAF5C,0EAZG,UAYH,aAGiDO,EAAcP,EAAE,IAHjE,oBAQZ,EAA0CP,EAAYC,EAAMC,EAAUC,EAAWC,GAAjF,mBAAK+B,EAAL,KAAaC,EAAb,KAAyBC,EAAzB,KA+XE,OA5XFC,qBAAU,WAMRhB,IAAUC,eAAepB,GACzBE,IAAU2B,EAAOO,SAASC,MAAM,SAAUrC,GAC1Ce,OAAOuB,iBAAiB,UAPH,WACnBrB,EAASF,OAAOC,YAChBE,EArCc,IAqCSnB,QAMxB,CA3Ce,IA2CDA,EAAUC,IAI3BmC,qBAAU,WACR,IAAMI,EAAarC,IAAU2B,EAAOO,SACpCG,EAAWC,OAAO,KAAKC,QAAQ,UAAU,GACzCF,EAAWC,OAAO,KAAKC,QAAQ,cAAc,GAC7CF,EAAWC,OAAO,KAAKC,QAAQ,iBAAiB,GAChDF,EAAWC,OAAO,KAAKC,QAAQ,eAAe,GAC9CF,EAAWC,OAAO,KAAKC,QAAQ,eAAe,GAC9CF,EAAWC,OAAO,KAAKC,QAAQ,YAAY,GAC3CF,EAAWC,OAAO,KAAKC,QAAQ,kBAAkB,GACjDF,EAAWC,OAAO,KAAKC,QAAQ,eAAe,GAC9CF,EAAWC,OAAO,KAAKC,QAAQ,UAAU,GACzCF,EAAWC,OAAO,QAAQC,QAAQ,qBAAqB,GACvDF,EAAWC,OAAO,QAAQC,QAAQ,kBAAkB,KACnD,IAGDN,qBAAU,WACR,IAAMI,EAAarC,IAAU2B,EAAOO,SA4EpCG,EAAWG,OAAO,WAAWC,MA1Ef,SAACC,GAAD,OAAOA,EAAEC,KAAK,YAAP,uBAAoC7C,EAAYC,EAAOO,OAAvD,MACnBsC,aAAaC,SA/CQ,MAgDrBF,KAAK,OAAQ,cACbA,KAAK,YAAaxB,GAClBsB,KAAKzC,IAAc8B,GAClBgB,MAAM9C,KACN+C,WAAW/C,IAAc,aACzBgD,UAAU,GAAKlD,EAAYC,EAAOQ,IAAMR,EAAOO,SAC/C2C,cAAc,IACfR,MAAK,SAAAC,GAAC,OAAIA,EAAEQ,UAAU,QACxBP,KAAK,SAAU,SACfA,KAAK,eAAgB,GACrBA,KAAK,iBAAkB,MACrBF,MAAK,SAAAC,GAAC,OAAIA,EAAEQ,UAAU,cACxBP,KAAK,SAAU,SACfA,KAAK,iBAAkB,GACvBA,KAAK,mBAAoB,OACzBA,KAAK,eAAgB,SA0DrBN,EAAWG,OAAO,kBAAkBC,MAxDf,SAACC,GAAD,OAAOA,EAAEC,KAAK,YAAP,oBAAiC5C,EAAOK,KAAxC,SAC1BwC,aAAaC,SAlEQ,MAmErBF,KAAK,OAAQ,cACbA,KAAK,YAAaxB,GAClBwB,KAAK,cAAe,QACpBA,KAAK,OA9EO,WA+EZF,KAAKzC,IAAYgC,GAChBc,MAAM,GACNE,SAAS,IACWP,MAAK,SAAAC,GAAC,OAAIA,EAAEQ,UAAU,QACtCP,KAAK,OAnFE,cAoFZF,MAAK,SAAAC,GAAC,OAAIA,EAAEQ,UAAU,QACjBP,KAAK,SAAU,SACfA,KAAK,eAAgB,GACrBA,KAAK,iBAAkB,MAC7BF,MAAK,SAAAC,GAAC,OAAIA,EAAEQ,UAAU,QAChBP,KAAK,SAAU,SACfA,KAAK,eAAgB,GACtBA,KAAK,iBAAkB,SAwC7BN,EAAWG,OAAO,eAAeC,MA9Bb,SAACC,GAAD,OAAOA,EAAEC,KAAK,YAAP,oBAAiC9C,EAAWE,EAAOM,MAAnD,SAC1BuC,aAAaC,SA9FS,MA+FtBF,KAAK,OAAQ,cACbA,KAAK,YAAaxB,GAClBwB,KAAK,cAAe,QACpBA,KAAK,OA3GK,WA4GVF,KAAKzC,IAAa+B,GACjBe,MAAM,EAAG,OACTE,SAAS,IACVP,MAAK,SAAAC,GAAC,OAAIA,EAAEQ,UAAU,QACjBP,KAAK,OAhHA,cAiHVF,MAAK,SAAAC,GAAC,OAAIA,EAAEQ,UAAU,QACjBP,KAAK,SAAU,SACfA,KAAK,eAAgB,GACrBA,KAAK,iBAAkB,MAC5BF,MAAK,SAAAC,GAAC,OAAIA,EAAEQ,UAAU,QACjBP,KAAK,SAAU,SACfA,KAAK,eAAgB,GACrBA,KAAK,iBAAkB,YAiB/BV,qBAAU,WACR,IAAMI,EAAarC,IAAU2B,EAAOO,SAE9BiB,EAAO,CAAC,eAAgB,0BACxBC,EAAQpD,MACXC,OAAOkD,GACPhD,MAAM,CA9IK,UADH,YAiJXkC,EAAWG,OAAO,WAAWU,UAAU,UAC1CtD,KAAKuD,GACLE,MACC,SAAAC,GAAK,OAAIA,EAAMhB,OAAO,UACrBK,KAAK,MAAM,SAACzC,EAAEqD,GAAH,OAAU,EAAEA,GAAGxD,EAAOK,KAAOmD,GAAG1D,EAAWE,EAAOM,UAC7DsC,KAAK,KAAO5C,EAAOQ,IAAI,GACvBoC,KAAK,IAAKa,SAASpC,GAAkB,GACrCe,MAAM,QAAQ,SAAAjC,GAAC,OAAIkD,EAAMlD,MACzByC,KAAK,UAAW,GAChBF,MAAK,SAAAgB,GAAE,OAAIA,EAAGb,aAAaC,SAjJH,MAiJgCF,KAAK,UAAW,SACzE,SAAAe,GAAM,OAAIA,EAAOjB,MAAK,SAAAgB,GAAE,OACtBA,EAAGb,aAAaC,SAnJO,MAoJpBF,KAAK,MAAM,SAACzC,EAAEqD,GAAH,OAAU,EAAEA,GAAGxD,EAAOK,KAAOmD,GAAG1D,EAAWE,EAAOM,UAC7DsC,KAAK,KAAO5C,EAAOQ,IAAI,GACvBoC,KAAK,IAAKjB,WAAWN,GAAkB,GACvCuB,KAAK,UAAW,SAGnBN,EAAWG,OAAO,WAAWU,UAAU,QAC1CtD,KAAKuD,GACLE,MACC,SAAAC,GAAK,OAAIA,EAAMhB,OAAO,QACrBK,KAAK,IAAK5C,EAAOQ,IAAI,GACrBoD,MAAK,SAAAzD,GAAC,OAAIA,KACVyC,KAAK,YAAavB,GAClBuB,KAAK,cAAe,QACpBA,KAAK,cAAe,QACpBR,MAAM,qBAAsB,UAC5BA,MAAM,QAAQ,SAAAjC,GAAC,OAAIkD,EAAMlD,MACzBuC,MAAK,SAAAgB,GAAE,OAAIA,EAAGd,KAAK,KAAK,SAACzC,EAAEqD,GAC1B,IAAIK,EAAI7D,EAAOK,KAAOsB,WAAWN,GAAkB,EAAI,EAEvD,OADQ,IAAJmC,IAAOK,EAAI/D,EAAWE,EAAOM,MAAQqB,WAAWN,GAAkB,EAAKqC,EAAGI,QAAQ,GAAGC,wBAA0B,GAC5GF,WAGT,SAAAF,GAAM,OAAIA,EAAOjB,MAAK,SAAAgB,GAAE,OACtBA,EAAGb,aAAaC,SA5KO,MA6KpBF,KAAK,IAAK5C,EAAOQ,IAAI,GACrBoC,KAAK,YAAavB,GAClBuB,KAAK,KAAK,SAACzC,EAAEqD,GACnB,IAAIK,EAAI7D,EAAOK,KAAOsB,WAAWN,GAAkB,EAAI,EAEvD,OADQ,IAAJmC,IAAOK,EAAI/D,EAAWE,EAAOM,MAAQqB,WAAWN,GAAkB,EAAIqC,EAAGI,QAAQ,GAAGC,wBAA0B,GAC3GF,cAQN3B,qBAAU,WACR,IAAMI,EAAarC,IAAU2B,EAAOO,SAE9B6B,EAAc/D,MAClB4D,GAAE,SAAA1D,GAAC,OAAI4B,EAAO5B,EAAE,OAChB8D,GAAGhC,EAAc,IACjBiC,IAAG,SAAA/D,GAAC,OAAI8B,EAAc9B,EAAE,OAE1BmC,EAAWG,OAAO,gBAAgBU,UAAU,QAC/CtD,KAAK,CAACA,IACNyD,MACC,SAAAC,GAAK,OAAIA,EAAMhB,OAAO,QACrBC,QAAQ2B,IAAOC,MAAM,GACrBxB,KAAK,KAAK,SAACzC,GAAD,OAAO6D,EAAY7D,MAC7ByC,KAAK,OAhNU,WAiNfA,KAAK,eAAgB,IACrBA,KAAK,UAAW,GAChBF,MAAK,SAAAgB,GAAE,OAAIA,EAAGb,aAAaC,SA3MH,MA2MgCF,KAAK,UAAW,SACzE,SAAAe,GAAM,OAAIA,EACOf,KAAK,UAAW,GAChBF,MAAK,SAAAgB,GAAE,OACNA,EAAGb,aAAaC,SA/MT,MAgNJF,KAAK,KAAK,SAACzC,GAAD,OAAO6D,EAAY7D,MAClDyC,KAAK,UAAU,YAMfV,qBAAU,WACR,IAAMI,EAAarC,IAAU2B,EAAOO,SAE9BkC,EAAcpE,MACrB4D,GAAE,SAAA1D,GAAC,OAAI4B,EAAO5B,EAAE,OAChBmE,GAAE,SAAAnE,GAAC,OAAI8B,EAAc9B,EAAE,OAEtBmC,EAAWG,OAAO,gBAAgBU,UAAU,QAC/CtD,KAAK,CAACA,IACNyD,MACC,SAAAC,GAAK,OAAIA,EAAMhB,OAAO,QACrBC,QAAQ2B,IAAOI,MAAM,GACrB3B,KAAK,KAAK,SAACzC,GAAD,OAAOkE,EAAYlE,MAC7ByC,KAAK,SA5OU,WA6OfA,KAAK,eAAgB,GACrBA,KAAK,OAAQ,QACbA,KAAK,UAAW,GAChBF,MAAK,SAAAgB,GAAE,OAAIA,EAAGb,aAAaC,SAxOH,MAwOgCF,KAAK,UAAW,SACzE,SAAAe,GAAM,OAAIA,EACOf,KAAK,UAAW,GAChBF,MAAK,SAAAgB,GAAE,OACNA,EAAGb,aAAaC,SA5OT,MA6OJF,KAAK,KAAK,SAACzC,GAAD,OAAOkE,EAAYlE,MAC7ByC,KAAK,UAAW,YAMrCV,qBAAU,WACR,IAAMI,EAAarC,IAAU2B,EAAOO,SAE9BqC,EAAWvE,MAClB4D,GAAE,SAAA1D,GAAC,OAAI4B,EAAO5B,EAAE,OAChBmE,GAAE,SAAAnE,GAAC,OAAI6B,EAAW7B,EAAE,OAEnBmC,EAAWG,OAAO,aAAaU,UAAU,QAC5CtD,KAAK,CAACA,IACNyD,MACC,SAAAC,GAAK,OAAIA,EAAMhB,OAAO,QACrBC,QAAQ2B,IAAOI,MAAM,GACrB3B,KAAK,KAAK,SAACzC,GAAD,OAAOqE,EAASrE,MAC1ByC,KAAK,SA1QO,WA2QZA,KAAK,eAAgB,GACrBA,KAAK,OAAQ,QACbA,KAAK,UAAW,GAChBF,MAAK,SAAAgB,GAAE,OAAIA,EAAGb,aAAaC,SArQH,MAqQgCF,KAAK,UAAW,SACzE,SAAAe,GAAM,OAAIA,EACMf,KAAK,UAAW,GAChBF,MAAK,SAAAgB,GAAE,OACNA,EAAGb,aAAaC,SAzQR,MA0QLF,KAAK,KAAK,SAACzC,GAAD,OAAOqE,EAASrE,MAC1ByC,KAAK,UAAW,YAMpCV,qBAAU,WACR,IAAMI,EAAarC,IAAU2B,EAAOO,SAChCsC,EAAUxE,IAAU,YAExBqC,EAAWG,OAAO,mBAAmBU,UAAU,UAClDtD,KAAKA,GACLyD,MACC,SAAAC,GAAK,OACHA,EAAMhB,OAAO,UAEdC,QAAQ,UAAU,GAClBI,KAAK,MAAM,SAACzC,GAAD,OAAO4B,EAAO5B,EAAE,OAC3ByC,KAAK,MAAM,SAACzC,GAAD,OAAO8B,EAAc9B,EAAE,OAClCyC,KAAK,OAtSU,WAuSfA,KAAK,IAAK,GAEVF,MAAK,SAAAgB,GAAE,OAAIA,EAAGb,aAAaC,SAjSH,MAiSgCF,KAAK,IAAKtB,MAElEoD,GAAG,aAAa,SAACvE,GAChBsE,EAAQE,KAAK7C,EAAY3B,IACzB,IAAIyE,EAAc3E,IAAS4E,MAAQ/E,EAAS,EAAIG,IAAS4E,MAAQlD,WAAW8C,EAAQrC,MAAM,UAAYnC,IAAS4E,MAC3GC,EAAa7E,IAAS8E,MAAQhF,EAAU,EAAIE,IAAS8E,MAAQpD,WAAW8C,EAAQrC,MAAM,WAAanC,IAAS8E,MAChHN,EAAQrC,MAAM,OAAd,UAAyBwC,EAAzB,OAA2CxC,MAAM,MAAjD,UAA2D0C,EAA3D,OACAL,EAAQjC,QAAQ,QAAQ,GACxBiC,EAAQjC,QAAQ,QAAQ,MAEzBkC,GAAG,YAAY,SAACvE,GACfsE,EAAQjC,QAAQ,QAAQ,GACxBiC,EAAQjC,QAAQ,QAAQ,SAG1B,SAAAmB,GAAM,OAAIA,EAAOjB,MAAK,SAAAgB,GAAE,OAGtBA,EAAGb,aAAaC,SAnTO,MAoTpBF,KAAK,MAAM,SAACzC,GAAD,OAAO4B,EAAO5B,EAAE,OAC3ByC,KAAK,MAAM,SAACzC,GAAD,OAAO8B,EAAc9B,EAAE,OAIlCyC,KAAK,IAAKtB,GACVsB,KAAK,OAlUM,iBAoUhB,SAAAoC,GAAI,OAEFA,EAAKC,SAAS,YAChBP,GAAG,YAAa,MAChBA,GAAG,WAAY,MAEfhC,MAAK,SAAAgB,GAAE,OACNA,EAAGb,aAAaC,SAASoC,KACtBtC,KAAK,IAAK,GACVA,KAAK,OA7UO,WA8UZR,MAAM,UAAW,GACjB+C,kBAOJjD,qBAAU,WACR,IAAMI,EAAarC,IAAU2B,EAAOO,SAChCsC,EAAUxE,IAAU,YAExBqC,EAAWG,OAAO,gBAAgBU,UAAU,UAC/CtD,KAAKA,GACLyD,MACC,SAAAC,GAAK,OACHA,EAAMhB,OAAO,UAEdC,QAAQ,UAAU,GAClBI,KAAK,MAAM,SAACzC,GAAD,OAAO4B,EAAO5B,EAAE,OAC3ByC,KAAK,MAAM,SAACzC,GAAD,OAAO6B,EAAW7B,EAAE,OAC/ByC,KAAK,OApWO,WAqWZA,KAAK,IAAK,GAEVF,MAAK,SAAAgB,GAAE,OAAIA,EAAGb,aAAaC,SA9VH,MA8VgCF,KAAK,IAAKtB,MAElEoD,GAAG,aAAa,SAACvE,GAChB,IAAIyE,EAAc3E,IAAS4E,MAAQ/E,EAAS,EAAIG,IAAS4E,MAAQlD,WAAW8C,EAAQrC,MAAM,UAAYnC,IAAS4E,MAC3GC,EAAa7E,IAAS8E,MAAQhF,EAAU,EAAIE,IAAS8E,MAAQpD,WAAW8C,EAAQrC,MAAM,WAAanC,IAAS8E,MAChHN,EAAQrC,MAAM,OAAd,UAAyBwC,EAAzB,OAA2CxC,MAAM,MAAjD,UAA2D0C,EAA3D,OACAL,EAAQE,KAAK7C,EAAY3B,IACzBsE,EAAQjC,QAAQ,QAAQ,GACxBiC,EAAQjC,QAAQ,QAAQ,MAEzBkC,GAAG,YAAY,SAACvE,GACfsE,EAAQjC,QAAQ,QAAQ,GACxBiC,EAAQjC,QAAQ,QAAQ,SAG1B,SAAAmB,GAAM,OAAIA,EAAOjB,MAAK,SAAAgB,GAAE,OAGtBA,EAAGb,aAAaC,SAhXO,MAiXpBF,KAAK,MAAM,SAACzC,GAAD,OAAO4B,EAAO5B,EAAE,OACbyC,KAAK,MAAM,SAACzC,GAAD,OAAO6B,EAAW7B,EAAE,OAI/ByC,KAAK,IAAKtB,GACVsB,KAAK,OAhYX,iBAkYb,SAAAoC,GAAI,OAEFA,EAAKC,SAAS,YAChBP,GAAG,YAAa,MAChBA,GAAG,WAAY,MAEfhC,MAAK,SAAAgB,GAAE,OACNA,EAAGb,aAAaC,SAASoC,KACDtC,KAAK,IAAK,GACVA,KAAK,OA3YjB,WA4YYR,MAAM,UAAW,GACjB+C,kBAOvB,yBAAKC,UAAU,uBACpB,yBAAKA,UAAU,iBACf,yBAAKA,UAAU,gBAAgBC,IAAKzD,Q,MCparC0D,IAASC,OACP,kBAAC,IAAMC,WAAP,KACE,kBAAC,EAAD,OAEFC,SAASC,eAAe,W","file":"static/js/main.41a0d86c.chunk.js","sourcesContent":["import React, {useEffect, useState, useRef} from \"react\";\nimport { Streamlit, withStreamlitConnection,} from \"streamlit-component-lib\";\nimport * as d3 from \"d3\";\n\nimport styles from './TimeChart.css';\n\n// Create TimeChart component\nconst TimeChart = (props) => {\n\n  let aspectRatio = 0.38\n  const [svgWidth, setWidth ] = useState(window.innerWidth);\n  const [svgHeight, setHeight ] = useState(aspectRatio*svgWidth);\n  \n  Streamlit.setFrameHeight(svgHeight);\n\n  //let label_font_size = \"15px\";\n  let axis_font_size = `${11+5*svgWidth/1000}px`;\n  let legend_font_size = `${11+5*svgWidth/1000}px`;\n  let  circleRadius = 0.004*svgWidth;\n\n  let posColor = \"#f77f00\"\n  let activeColor = \"#ff006e\"\n\n  props.args.data =  props.args.data.map(d => [new Date( typeof d[0] == \"string\" ? d[0].split('T')[0]+'T12:00:00' : d[0]), d[1], d[2], d[3], d[4], d[5]]);\n  const data = props.args.data\n  \n  const margin = {\"top\": 50, \"bottom\": 50, \"left\": 2*parseFloat(axis_font_size)-5, \"right\": 3*parseFloat(axis_font_size)};\n \n  const svgRef = useRef(null);\n  const transitionMillisec = 1200;\n\n  const tooltipHtml = (d) => {\n    const html = `\n<p>Date: <strong>${formatDate(d[0])}</strong></p>\n<p>Active Cases: <strong style='color:${activeColor}'>${d[3]}</strong></p>\n<p>14-Day Positivity Rate: <strong style='color:${posColor}'>${formatPercent(d[1])}</strong></p>\n`\n    return html;\n  }\n\n  let [xScale, pos_yScale, active_yScale] = buildScales(data, svgWidth, svgHeight, margin);\n\n  // Set svgHeight and update it on window resize\n  useEffect(() => {\n    const handleResize = () =>{\n      setWidth(window.innerWidth);\n      setHeight( aspectRatio*svgWidth );\n    }\n    \n    Streamlit.setFrameHeight(svgHeight);\n    d3.select(svgRef.current).style(\"height\", svgHeight);\n    window.addEventListener('resize', handleResize)\n  }, [aspectRatio, svgWidth, svgHeight])\n\n  \n  // On mount, create group containers for circles, path and both axis\n  useEffect(() => {\n    const svgElement = d3.select(svgRef.current);\n    svgElement.append(\"g\").classed('x-axis', true);\n    svgElement.append(\"g\").classed('y-axis-pos', true);\n    svgElement.append(\"g\").classed('y-axis-active', true);\n    svgElement.append(\"g\").classed('active-area', true);\n    svgElement.append(\"g\").classed('active-line', true);\n    svgElement.append(\"g\").classed('pos-line', true);\n    svgElement.append(\"g\").classed('active-circles', true);\n    svgElement.append(\"g\").classed('pos-circles', true);\n    svgElement.append(\"g\").classed('legend', true);\n    svgElement.append(\"text\").classed('active-axis-label', true);\n    svgElement.append(\"text\").classed('pos-axis-label', true);\n  }, [])\n\n    // Hook to create / update axis and grid\n    useEffect(() => {\n      const svgElement = d3.select(svgRef.current);\n      \n      const xAxis = (g) => g.attr(\"transform\", `translate(0, ${svgHeight - margin.bottom})`)\n\t\t\t    .transition().duration(transitionMillisec)\n\t\t\t    .attr(\"font\", \"sans-serif\")\n\t\t\t    .attr(\"font-size\", axis_font_size)\n\t\t\t    .call(d3.axisBottom(xScale)\n\t\t\t\t    .ticks(d3.timeWeek)\n\t\t\t\t    .tickFormat(d3.timeFormat(\"%m/%d/%y\"))\n\t\t\t\t    .tickSize(-1 * (svgHeight - margin.top - margin.bottom))\n\t\t\t\t    .tickSizeOuter(0))\n\t\t\t    .call(g => g.selectAll(\"path\")\n\t\t\t\t\t.attr(\"stroke\", \"black\")\n\t\t\t\t\t.attr(\"stroke-width\", 1)\n\t\t\t\t\t.attr(\"stroke-opacity\", 1))\n\t\t\t    .call(g => g.selectAll(\".tick line\")\n\t\t\t\t\t.attr(\"stroke\", \"black\")\n\t\t\t\t\t.attr(\"stroke-opacity\", 1)\n\t\t\t\t\t.attr(\"stroke-dasharray\", \"2,2\")\n\t\t\t\t\t.attr(\"stroke-width\", 1));\n        \n      const active_yAxis = (g) => g.attr(\"transform\", `translate(${margin.left}, 0)`)\n\t\t\t\t   .transition().duration(transitionMillisec)\n\t\t\t\t   .attr(\"font\", \"sans-serif\")\n\t\t\t\t   .attr(\"font-size\", axis_font_size)\n\t\t\t\t   .attr(\"font-weight\", \"bold\")\n\t\t\t\t   .attr(\"fill\", activeColor)\n\t\t\t\t   .call(d3.axisLeft(active_yScale)\n\t\t\t\t\t   .ticks(5)\n\t\t\t\t\t   .tickSize(4))\n\t                           .call(g => g.selectAll('text')\n\t\t\t\t\t       .attr(\"fill\", activeColor))\n\t\t\t\t   .call(g => g.selectAll(\"path\")\n\t\t\t\t\t       .attr(\"stroke\", \"black\" )\n\t\t\t\t\t       .attr(\"stroke-width\", 1)\n\t\t\t\t\t       .attr(\"stroke-opacity\", 1))\n\t\t\t\t  .call(g => g.selectAll(\"line\")\n\t\t\t\t\t       .attr(\"stroke\", \"black\")\n\t\t\t\t\t       .attr(\"stroke-width\", 1)\n\t\t\t\t\t      .attr(\"stroke-opacity\", 1));\n //      const active_label = (g) => g.text(\"Active Cases\")\n//\t\t\t\t   .attr(\"transform\", \"rotate(-90)\")\n//\t\t\t\t   .transition().duration(transitionMillisec)\n//\t\t\t\t   .attr(\"x\", 0 - ((svgWidth - margin.left) / 3.03))\n//\t\t\t\t   .attr(\"y\", 15)\n//\t\t\t\t   .style(\"text-anchor\", \"middle\")\n//\t\t\t\t   .attr(\"font\", \"sans-serif\")\n//\t\t\t\t   .attr(\"font-size\", label_font_size);\n      \n        const pos_yAxis = (g) => g.attr(\"transform\", `translate(${svgWidth - margin.right}, 0)`)\n\t\t\t\t  .transition().duration(transitionMillisec)\n\t\t\t\t  .attr(\"font\", \"sans-serif\")\n\t\t\t\t  .attr(\"font-size\", axis_font_size)\n\t\t\t\t  .attr(\"font-weight\", \"bold\")\n\t\t\t\t  .attr(\"fill\", posColor)\n\t\t\t\t  .call(d3.axisRight(pos_yScale)\n\t\t\t\t\t  .ticks(5, \".1%\")\t\t\t\t    \n\t\t\t\t\t  .tickSize(4))\n\t\t\t\t  .call(g => g.selectAll('text')\n\t\t\t\t\t      .attr(\"fill\", posColor))\n\t\t\t\t  .call(g => g.selectAll(\"path\")\n\t\t\t\t\t      .attr(\"stroke\", \"black\")\n\t\t\t\t\t      .attr(\"stroke-width\", 1)\n\t\t\t\t\t      .attr(\"stroke-opacity\", 1))\n\t\t\t\t  .call(g => g.selectAll(\"line\")\n\t\t\t\t\t      .attr(\"stroke\", \"black\")\n\t\t\t\t\t      .attr(\"stroke-width\", 1)\n\t\t\t\t\t      .attr(\"stroke-opacity\", 1));\n//      const pos_label = (g) => g.text(\"14-Day Positivity Rates\")\n//\t\t\t\t.attr(\"transform\", \"rotate(-270)\")\n//\t\t\t\t.transition().duration(transitionMillisec)\n//\t\t\t\t.attr(\"x\", (svgHeight - margin.bottom) / 2.1)\n//\t\t\t\t.attr(\"y\", 0 - (svgWidth) + 10)\n//\t\t\t\t.style(\"text-anchor\", \"middle\")\n//\t\t\t\t.attr(\"font-size\", label_font_size);\n\n      svgElement.select(\".x-axis\").call(xAxis);\n      svgElement.select(\".y-axis-active\").call(active_yAxis);\n      //svgElement.select(\".active-axis-label\").call(active_label);\n      svgElement.select(\".y-axis-pos\").call(pos_yAxis);\n      //svgElement.select(\".pos-axis-label\").call(pos_label);\n    })\n\n    // Hook to create / update legend\n    useEffect(() => {\n      const svgElement = d3.select(svgRef.current);\n      \n      const keys = [\"Active Cases\", \"14-Day Positivity Rate\"];\n      const color = d3.scaleOrdinal()\n\t\t      .domain(keys)\n\t\t      .range([activeColor, posColor]);\n\n      svgElement.select(\".legend\").selectAll(\"circle\")\n\t\t.data(keys)\t\n\t\t.join(\n\t\t  enter => enter.append(\"circle\")\n\t\t\t\t.attr(\"cx\", (d,i) => (1-i)*margin.left + i*(svgWidth - margin.right))\n\t\t\t\t.attr(\"cy\",  margin.top/2 )\n\t\t\t\t.attr(\"r\", parseInt(legend_font_size)/2)\n\t\t\t\t.style(\"fill\", d => color(d))\n\t\t\t\t.attr(\"opacity\", 0)\n\t\t\t\t.call(el => el.transition().duration(transitionMillisec).attr(\"opacity\", 1)),\n\t\t  update => update.call(el =>\n\t\t    el.transition().duration(transitionMillisec)\n\t\t      .attr(\"cx\", (d,i) => (1-i)*margin.left + i*(svgWidth - margin.right))\n\t\t      .attr(\"cy\",  margin.top/2 )\n\t\t      .attr(\"r\", parseFloat(legend_font_size)/2)\n\t\t      .attr(\"opacity\", 1)\n\t\t  ))\n\t\t\n      svgElement.select(\".legend\").selectAll(\"text\")\n\t\t.data(keys)\n\t\t.join(\n\t\t  enter => enter.append(\"text\")\n\t\t\t\t.attr(\"y\", margin.top/2)\n\t\t\t\t.text(d => d )\n\t\t\t\t.attr(\"font-size\", legend_font_size)\n\t\t\t\t.attr(\"font-weight\", \"bold\")\n\t\t\t\t.attr(\"text-anchor\", \"left\")\n\t\t\t\t.style(\"alignment-baseline\", \"middle\")\n\t\t\t\t.style(\"fill\", d => color(d) )\n\t\t\t\t.call(el => el.attr(\"x\", (d,i) =>{\n\t\t\t\t  let x = margin.left + parseFloat(legend_font_size)/2 + 3;\n\t\t\t\t  if (i===1) x = svgWidth - margin.right - parseFloat(legend_font_size)/2 -  el.nodes()[1].getComputedTextLength() - 3\n\t\t\t\t  return x\n\t\t\t\t})\n\t\t\t\t), \n\t\t  update => update.call(el =>\n\t\t    el.transition().duration(transitionMillisec)\n\t\t      .attr(\"y\", margin.top/2)\n\t\t      .attr(\"font-size\", legend_font_size)\n\t\t      .attr(\"x\", (d,i) =>{\n\t\t\tlet x = margin.left + parseFloat(legend_font_size)/2 + 3;\n\t\t\tif (i===1) x = svgWidth - margin.right - parseFloat(legend_font_size)/2 - el.nodes()[1].getComputedTextLength() - 3;\n\t\t\treturn x\n\t\t      })\n\t\t  )\n\t\t)\n    })\n\n\n    // create / update active-area\n    useEffect(() => {\n      const svgElement = d3.select(svgRef.current);\n      \n      const active_area = d3.area()\n\t\t\t    .x(d => xScale(d[0]))\n\t\t\t    .y0(active_yScale(0))\n\t\t\t    .y1(d => active_yScale(d[3]));\n\n      svgElement.select(\".active-area\").selectAll(\"path\")\n\t\t.data([data]) // Array with 1 element keyed by index, so enters once then only updates\n\t\t.join(\n\t\t  enter => enter.append(\"path\")\n\t\t\t\t.classed(styles.area, true)\n\t\t\t\t.attr(\"d\", (d) => active_area(d))\n\t\t\t\t.attr(\"fill\", activeColor)\n\t\t\t\t.attr(\"fill-opacity\", 0.3)\n\t\t\t\t.attr(\"opacity\", 0)\n\t\t\t\t.call(el => el.transition().duration(transitionMillisec).attr(\"opacity\", 1)),\n\t\t  update => update\n                    .attr(\"opacity\", 0)\n                    .call(el =>\n                      el.transition().duration(transitionMillisec)\n                        .attr(\"d\", (d) => active_area(d))\n\t\t\t.attr(\"opacity\",1)\n                    ),\n\t\t);\n    })\n\n    // create / update active-line\n    useEffect(() => {\n      const svgElement = d3.select(svgRef.current);\n      \n      const active_line = d3.line()\n\t\t\t .x(d => xScale(d[0]))\n\t\t\t .y(d => active_yScale(d[3]));\n      \n      svgElement.select(\".active-line\").selectAll(\"path\")\n\t\t.data([data]) // Array with 1 element keyed by index, so enters once then only updates\n\t\t.join(\n\t\t  enter => enter.append(\"path\")\n\t\t\t\t.classed(styles.line, true)\n\t\t\t\t.attr(\"d\", (d) => active_line(d))\n\t\t\t\t.attr(\"stroke\", activeColor)\n\t\t\t\t.attr(\"stroke-width\", 2)\n\t\t\t\t.attr(\"fill\", \"none\")\n\t\t\t\t.attr(\"opacity\", 0)\n\t\t\t\t.call(el => el.transition().duration(transitionMillisec).attr(\"opacity\", 1)),\n\t\t  update => update\n                    .attr(\"opacity\", 0)\n                    .call(el =>\n                      el.transition().duration(transitionMillisec)\n                        .attr(\"d\", (d) => active_line(d))\n                        .attr(\"opacity\", 1)\n                    ),\n\t\t);\n    })\n\n    // create / update pos-line\n    useEffect(() => {\n      const svgElement = d3.select(svgRef.current);\n\t\n      const pos_line = d3.line()\n\t\t\t .x(d => xScale(d[0]))\n\t\t\t .y(d => pos_yScale(d[1]));\n\t\n      svgElement.select(\".pos-line\").selectAll(\"path\")\n\t\t.data([data]) // Array with 1 element keyed by index, so enters once then only updates\n\t\t.join(\n\t\t  enter => enter.append(\"path\")\n\t\t\t\t.classed(styles.line, true)\n\t\t\t\t.attr(\"d\", (d) => pos_line(d))\n\t\t\t\t.attr(\"stroke\", posColor)\n\t\t\t\t.attr(\"stroke-width\", 2)\n\t\t\t\t.attr(\"fill\", \"none\")\n\t\t\t\t.attr(\"opacity\", 0)\n\t\t\t\t.call(el => el.transition().duration(transitionMillisec).attr(\"opacity\", 1)),\n\t\t  update => update\n                   .attr(\"opacity\", 0)\n                   .call(el =>\n                     el.transition().duration(transitionMillisec)\n                       .attr(\"d\", (d) => pos_line(d))\n                       .attr(\"opacity\", 1)\n                   ),\n\t\t);\n    })\n\n    // Hook to create / update active-circles\n    useEffect(() => {\n      const svgElement = d3.select(svgRef.current);\n      let tooltip = d3.select(\".tooltip\");\n\t\n      svgElement.select(\".active-circles\").selectAll(\"circle\")\n\t\t.data(data)\n\t\t.join(\n\t\t  enter => (\n\t\t    enter.append(\"circle\")\n\t\t      // Bind each circle to [x,y] coordinate\n\t\t\t .classed(\"circle\", true)\n\t\t\t .attr(\"cx\", (d) => xScale(d[0]))\n\t\t\t .attr(\"cy\", (d) => active_yScale(d[3]))\n\t\t\t .attr(\"fill\", activeColor)\n\t\t\t .attr(\"r\", 0)\n\t\t      // Transition from invisible to visible circle\n\t\t\t .call(el => el.transition().duration(transitionMillisec).attr(\"r\", circleRadius))\n\t\t      // Add d3 mouseover to display and move tooltip around\n\t\t\t .on(\"mouseover\", (d) => {\n\t\t\t   tooltip.html(tooltipHtml(d));\n\t\t\t   let tooltipLeft = d3.event.pageX > svgWidth/2 ? d3.event.pageX - parseFloat(tooltip.style('width')) : d3.event.pageX;\n\t\t\t   let tooltipTop = d3.event.pageY > svgHeight/2 ? d3.event.pageY - parseFloat(tooltip.style('height')) : d3.event.pageY;\n\t\t\t   tooltip.style(\"left\", `${tooltipLeft}px` ).style(\"top\", `${tooltipTop}px`);\n\t\t\t   tooltip.classed(\"hide\", false);\n\t\t\t   tooltip.classed(\"show\", true);\n\t\t\t })\n\t\t\t .on(\"mouseout\", (d) => {\n\t\t\t   tooltip.classed(\"show\", false);\n\t\t\t   tooltip.classed(\"hide\", true);\n\t\t\t })\n\t\t  ),\n\t\t  update => update.call(el =>\n\t\t    // If circle has not changed coordinates, maybe data scale changed\n\t\t    // so transition from original position to new position\n\t\t    el.transition().duration(transitionMillisec)\n\t\t      .attr(\"cx\", (d) => xScale(d[0]))\n\t\t      .attr(\"cy\", (d) => active_yScale(d[3]))\n\t\t      // NB : keep radius value, it seems in Streamlit lifecycle there are 2 renders when mounting ?\n\t\t\t\t\t    // so circles enter and during transition to full radius rerender\n\t\t    // so if r < circleRadius while update then animation breaks and circle stay small for first render\n\t\t      .attr(\"r\", circleRadius)\n\t\t      .attr(\"fill\", activeColor)\n\t\t  ),\n\t\t  exit => (\n\t\t    // Close tooltip and remove mouse events\n\t\t    exit.dispatch(\"mouseout\")\n\t\t\t.on(\"mouseover\", null)\n\t\t\t.on(\"mouseout\", null)\n\t\t      // Transition from visible to invisible circle then remove entirely\n\t\t\t.call(el =>\n\t\t\t  el.transition().duration(transitionMillisec / 2)\n\t\t\t    .attr(\"r\", 0)\n\t\t\t    .attr(\"fill\", activeColor)\n\t\t\t    .style(\"opacity\", 0)\n\t\t\t    .remove()\n\t\t\t)\n\t\t  ),\n\t\t)\n    })\n\n    // Hook to create / update pos-circles\n    useEffect(() => {\n      const svgElement = d3.select(svgRef.current);\n      let tooltip = d3.select(\".tooltip\");\n\n      svgElement.select(\".pos-circles\").selectAll(\"circle\")\n\t\t.data(data)\n\t\t.join(\n\t\t  enter => (\n\t\t    enter.append(\"circle\")\n                      // Bind each circle to [x,y] coordinate\n\t\t\t .classed(\"circle\", true)\n\t\t\t .attr(\"cx\", (d) => xScale(d[0]))\n\t\t\t .attr(\"cy\", (d) => pos_yScale(d[1]))\n\t\t\t .attr(\"fill\", posColor)\n\t\t\t .attr(\"r\", 0)\n                      // Transition from invisible to visible circle\n\t\t\t .call(el => el.transition().duration(transitionMillisec).attr(\"r\", circleRadius))\n                      // Add d3 mouseover to display and move tooltip around\n\t\t\t .on(\"mouseover\", (d) => {\n\t\t\t   let tooltipLeft = d3.event.pageX > svgWidth/2 ? d3.event.pageX - parseFloat(tooltip.style('width')) : d3.event.pageX;\n\t\t\t   let tooltipTop = d3.event.pageY > svgHeight/2 ? d3.event.pageY - parseFloat(tooltip.style('height')) : d3.event.pageY;\n\t\t\t   tooltip.style(\"left\", `${tooltipLeft}px` ).style(\"top\", `${tooltipTop}px`);\n\t\t\t   tooltip.html(tooltipHtml(d));\n\t\t\t   tooltip.classed(\"hide\", false);\n\t\t\t   tooltip.classed(\"show\", true);\n\t\t\t })\n\t\t\t .on(\"mouseout\", (d) => {\n\t\t\t   tooltip.classed(\"show\", false);\n\t\t\t   tooltip.classed(\"hide\", true);\n\t\t\t })\n\t\t  ),\n\t\t  update => update.call(el =>\n\t\t    // If circle has not changed coordinates, maybe data scale changed\n\t\t    // so transition from original position to new position\n\t\t    el.transition().duration(transitionMillisec)\n\t\t      .attr(\"cx\", (d) => xScale(d[0]))\n                      .attr(\"cy\", (d) => pos_yScale(d[1]))\n                      // NB : keep radius value, it seems in Streamlit lifecycle there are 2 renders when mounting ?\n                      // so circles enter and during transition to full radius rerender\n                      // so if r < circleRadius while update then animation breaks and circle stay small for first render\n                      .attr(\"r\", circleRadius)\n                      .attr(\"fill\", posColor)\n\t\t  ),\n\t\t  exit => (\n\t\t    // Close tooltip and remove mouse events\n\t\t    exit.dispatch(\"mouseout\")\n\t\t\t.on(\"mouseover\", null)\n\t\t\t.on(\"mouseout\", null)\n                      // Transition from visible to invisible circle then remove entirely\n\t\t\t.call(el =>\n\t\t\t  el.transition().duration(transitionMillisec / 2)\n                            .attr(\"r\", 0)\n                            .attr(\"fill\", posColor)\n                            .style(\"opacity\", 0)\n                            .remove()\n\t\t\t)\n\t\t  ),\n\t\t)\n    })\n\n    return (\n      <div className=\"timechart-container\">\n\t<div className='tooltip hide' />\n\t<svg className=\"timechart-svg\" ref={svgRef}  />\n      </div>\n    )\n    \n}\n\n// Build D3 scales from data\nconst buildScales = (data, svgWidth, svgHeight, margin) => {\n  \n  const xScale = d3.scaleTime()\n\t\t   .domain(d3.extent(data, (d) => d[0]))\n\t\t   .range([margin.left, svgWidth - margin.right]);\n  const pos_yScale = d3.scaleLinear()\n\t\t       .domain([0, d3.max(data, (d) => d[1])])\n\t\t       .range([svgHeight - margin.bottom, margin.top]);\n  const active_yScale = d3.scaleLinear()\n\t\t\t  .domain([0, d3.max(data, (d) => d[3])])\n\t\t\t  .range([svgHeight - margin.bottom, margin.top]);\n\n  return [xScale, pos_yScale, active_yScale]\n}\n\n// Format helpers\nconst formatDate = d3.timeFormat(\"%m/%d/%y\");\nconst formatPercent = d3.format(\".2%\")\n\n// Export component  \nexport default withStreamlitConnection(TimeChart)\n","import React from \"react\"\nimport ReactDOM from \"react-dom\"\nimport TimeChart from \"./TimeChart\"\n\nimport \"./index.css\"\n\nReactDOM.render(\n  <React.StrictMode>\n    <TimeChart />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n)\n"],"sourceRoot":""}