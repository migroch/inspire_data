{"version":3,"sources":["TimeChart.jsx","index.jsx"],"names":["buildScales","data","svgWidth","svgHeight","margin","d3","domain","d","range","left","right","bottom","top","formatDate","formatPercent","get_client_dimensions","clientsWidth","clientsHeight","window","innerWidth","innerHeight","document","documentElement","clientWidth","clientHeight","body","withStreamlitConnection","props","aspectRatio","dimensions","useState","width","setWidth","setHeight","Streamlit","setFrameHeight","axis_font_size","legend_font_size","circleRadius","args","map","Date","split","parseFloat","svgRef","useRef","tooltipHtml","xScale","pos_yScale","active_yScale","useEffect","current","style","addEventListener","svgElement","append","classed","select","call","g","attr","transition","duration","ticks","tickFormat","tickSize","tickSizeOuter","selectAll","keys","color","join","enter","i","parseInt","el","update","text","x","nodes","getComputedTextLength","active_area","y0","y1","styles","area","active_line","y","line","pos_line","tooltip","on","html","tooltipLeft","pageX","tooltipTop","pageY","exit","dispatch","transitionMillisec","remove","className","ref","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.1bd02b57.chunk.js","sourcesContent":["import React, {useEffect, useState, useRef} from \"react\";\nimport { Streamlit, withStreamlitConnection,} from \"streamlit-component-lib\";\nimport * as d3 from \"d3\";\n\nimport styles from './TimeChart.css';\n\n// Create TimeChart component\nconst TimeChart = (props) => {\n\n  let aspectRatio = 0.38\n  let dimensions = get_client_dimensions();\n  const [svgWidth, setWidth ] = useState(dimensions.width);\n  if (svgWidth < 600) aspectRatio = 0.68\n  const [svgHeight, setHeight ] = useState(aspectRatio*svgWidth);\n  \n  Streamlit.setFrameHeight(svgHeight);\n\n  //let label_font_size = \"15px\";\n  let axis_font_size = `${11+5*svgWidth/1000}px`;\n  let legend_font_size = `${11+5*svgWidth/1000}px`;\n  let  circleRadius = 0.004*svgWidth;\n\n  let posColor = \"#f77f00\"\n  let activeColor = \"#ff006e\"\n\n  props.args.data =  props.args.data.map(d => [new Date( typeof d[0] == \"string\" ? d[0].split('T')[0]+'T12:00:00' : d[0]), d[1], d[2], d[3], d[4], d[5]]);\n  const data = props.args.data\n  \n  const margin = {\"top\": 50, \"bottom\": 4*parseFloat(axis_font_size), \"left\": 2*parseFloat(axis_font_size)-5, \"right\": 3*parseFloat(axis_font_size)};\n \n  const svgRef = useRef(null);\n  const transitionMillisec = 1200;\n\n  const tooltipHtml = (d) => {\n    const html = `\n<p>Date: <strong>${formatDate(d[0])}</strong></p>\n<p>Active Cases: <strong style='color:${activeColor}'>${d[3]}</strong></p>\n<p>14-Day Positivity Rate: <strong style='color:${posColor}'>${formatPercent(d[1])}</strong></p>\n`\n    return html;\n  }\n\n  let [xScale, pos_yScale, active_yScale] = buildScales(data, svgWidth, svgHeight, margin);\n\n  // Set svgHeight and update it on window resize\n  useEffect(() => {\n    const handleResize = () =>{\n      let aspectRatio = 0.38\n      let dimensions = get_client_dimensions();\n      setWidth(dimensions.width);\n      if (svgWidth < 600) aspectRatio = 0.61;\n      setHeight( aspectRatio*svgWidth );\n    }\n    \n    Streamlit.setFrameHeight(svgHeight);\n    d3.select(svgRef.current).style(\"height\", svgHeight);\n    window.addEventListener('resize', handleResize)\n  }, [svgWidth, svgHeight])\n\n  \n  // On mount, create group containers for circles, path and both axis\n  useEffect(() => {\n    const svgElement = d3.select(svgRef.current);\n    svgElement.append(\"g\").classed('x-axis', true);\n    svgElement.append(\"g\").classed('y-axis-pos', true);\n    svgElement.append(\"g\").classed('y-axis-active', true);\n    svgElement.append(\"g\").classed('active-area', true);\n    svgElement.append(\"g\").classed('active-line', true);\n    svgElement.append(\"g\").classed('pos-line', true);\n    svgElement.append(\"g\").classed('active-circles', true);\n    svgElement.append(\"g\").classed('pos-circles', true);\n    svgElement.append(\"g\").classed('legend', true);\n    svgElement.append(\"text\").classed('active-axis-label', true);\n    svgElement.append(\"text\").classed('pos-axis-label', true);\n  }, [])\n\n    // Hook to create / update axis and grid\n    useEffect(() => {\n      const svgElement = d3.select(svgRef.current);\n      \n      const xAxis = (g) => g.attr(\"transform\", `translate(0, ${svgHeight - margin.bottom})`)\n\t\t\t    .transition().duration(transitionMillisec)\n\t\t\t    .attr(\"font\", \"sans-serif\")\n\t\t\t    .attr(\"font-size\", axis_font_size)\n\t\t\t    .call(d3.axisBottom(xScale)\n\t\t\t\t    .ticks(d3.timeWeek)\n\t\t\t\t    .tickFormat(d3.timeFormat(\"%m/%d/%y\"))\n\t\t\t\t    .tickSize(-1 * (svgHeight - margin.top - margin.bottom))\n\t\t\t\t    .tickSizeOuter(0))\n\t\t\t    .call(g => g.selectAll('text')\n\t\t\t\t\t.style(\"text-anchor\", \"end\")\n\t\t\t\t\t.attr(\"transform\", \"rotate(-65)\"))\n\t\t\t    .call(g => g.selectAll(\"path\")\n\t\t\t\t\t.attr(\"stroke\", \"black\")\n\t\t\t\t\t.attr(\"stroke-width\", 1)\n\t\t\t\t\t.attr(\"stroke-opacity\", 1))\n\t\t\t    .call(g => g.selectAll(\".tick line\")\n\t\t\t\t\t.attr(\"stroke\", \"black\")\n\t\t\t\t\t.attr(\"stroke-opacity\", 1)\n\t\t\t\t\t.attr(\"stroke-dasharray\", \"2,2\")\n\t\t\t\t\t.attr(\"stroke-width\", 1));\n        \n      const active_yAxis = (g) => g.attr(\"transform\", `translate(${margin.left}, 0)`)\n\t\t\t\t   .transition().duration(transitionMillisec)\n\t\t\t\t   .attr(\"font\", \"sans-serif\")\n\t\t\t\t   .attr(\"font-size\", axis_font_size)\n\t\t\t\t   .attr(\"font-weight\", \"bold\")\n\t\t\t\t   .attr(\"fill\", activeColor)\n\t\t\t\t   .call(d3.axisLeft(active_yScale)\n\t\t\t\t\t   .ticks(5)\n\t\t\t\t\t   .tickSize(4))\n\t                           .call(g => g.selectAll('text')\n\t\t\t\t\t       .attr(\"fill\", activeColor))\n\t\t\t\t   .call(g => g.selectAll(\"path\")\n\t\t\t\t\t       .attr(\"stroke\", \"black\" )\n\t\t\t\t\t       .attr(\"stroke-width\", 1)\n\t\t\t\t\t       .attr(\"stroke-opacity\", 1))\n\t\t\t\t  .call(g => g.selectAll(\"line\")\n\t\t\t\t\t       .attr(\"stroke\", \"black\")\n\t\t\t\t\t       .attr(\"stroke-width\", 1)\n\t\t\t\t\t      .attr(\"stroke-opacity\", 1));\n //      const active_label = (g) => g.text(\"Active Cases\")\n//\t\t\t\t   .attr(\"transform\", \"rotate(-90)\")\n//\t\t\t\t   .transition().duration(transitionMillisec)\n//\t\t\t\t   .attr(\"x\", 0 - ((svgWidth - margin.left) / 3.03))\n//\t\t\t\t   .attr(\"y\", 15)\n//\t\t\t\t   .style(\"text-anchor\", \"middle\")\n//\t\t\t\t   .attr(\"font\", \"sans-serif\")\n//\t\t\t\t   .attr(\"font-size\", label_font_size);\n      \n        const pos_yAxis = (g) => g.attr(\"transform\", `translate(${svgWidth - margin.right}, 0)`)\n\t\t\t\t  .transition().duration(transitionMillisec)\n\t\t\t\t  .attr(\"font\", \"sans-serif\")\n\t\t\t\t  .attr(\"font-size\", axis_font_size)\n\t\t\t\t  .attr(\"font-weight\", \"bold\")\n\t\t\t\t  .attr(\"fill\", posColor)\n\t\t\t\t  .call(d3.axisRight(pos_yScale)\n\t\t\t\t\t  .ticks(5, \".1%\")\t\t\t\t    \n\t\t\t\t\t  .tickSize(4))\n\t\t\t\t  .call(g => g.selectAll('text')\n\t\t\t\t\t      .attr(\"fill\", posColor))\n\t\t\t\t  .call(g => g.selectAll(\"path\")\n\t\t\t\t\t      .attr(\"stroke\", \"black\")\n\t\t\t\t\t      .attr(\"stroke-width\", 1)\n\t\t\t\t\t      .attr(\"stroke-opacity\", 1))\n\t\t\t\t  .call(g => g.selectAll(\"line\")\n\t\t\t\t\t      .attr(\"stroke\", \"black\")\n\t\t\t\t\t      .attr(\"stroke-width\", 1)\n\t\t\t\t\t      .attr(\"stroke-opacity\", 1));\n//      const pos_label = (g) => g.text(\"14-Day Positivity Rates\")\n//\t\t\t\t.attr(\"transform\", \"rotate(-270)\")\n//\t\t\t\t.transition().duration(transitionMillisec)\n//\t\t\t\t.attr(\"x\", (svgHeight - margin.bottom) / 2.1)\n//\t\t\t\t.attr(\"y\", 0 - (svgWidth) + 10)\n//\t\t\t\t.style(\"text-anchor\", \"middle\")\n//\t\t\t\t.attr(\"font-size\", label_font_size);\n\n      svgElement.select(\".x-axis\").call(xAxis);\n      svgElement.select(\".y-axis-active\").call(active_yAxis);\n      //svgElement.select(\".active-axis-label\").call(active_label);\n      svgElement.select(\".y-axis-pos\").call(pos_yAxis);\n      //svgElement.select(\".pos-axis-label\").call(pos_label);\n    })\n\n    // Hook to create / update legend\n    useEffect(() => {\n      const svgElement = d3.select(svgRef.current);\n      \n      const keys = [\"Active Cases\", \"14-Day Positivity Rate\"];\n      const color = d3.scaleOrdinal()\n\t\t      .domain(keys)\n\t\t      .range([activeColor, posColor]);\n\n      svgElement.select(\".legend\").selectAll(\"circle\")\n\t\t.data(keys)\t\n\t\t.join(\n\t\t  enter => enter.append(\"circle\")\n\t\t\t\t.attr(\"cx\", (d,i) => (1-i)*margin.left + i*(svgWidth - margin.right))\n\t\t\t\t.attr(\"cy\",  margin.top/2 )\n\t\t\t\t.attr(\"r\", parseInt(legend_font_size)/2)\n\t\t\t\t.style(\"fill\", d => color(d))\n\t\t\t\t.attr(\"opacity\", 0)\n\t\t\t\t.call(el => el.transition().duration(transitionMillisec).attr(\"opacity\", 1)),\n\t\t  update => update.call(el =>\n\t\t    el.transition().duration(transitionMillisec)\n\t\t      .attr(\"cx\", (d,i) => (1-i)*margin.left + i*(svgWidth - margin.right))\n\t\t      .attr(\"cy\",  margin.top/2 )\n\t\t      .attr(\"r\", parseFloat(legend_font_size)/2)\n\t\t      .attr(\"opacity\", 1)\n\t\t  ))\n\t\t\n      svgElement.select(\".legend\").selectAll(\"text\")\n\t\t.data(keys)\n\t\t.join(\n\t\t  enter => enter.append(\"text\")\n\t\t\t\t.attr(\"y\", margin.top/2)\n\t\t\t\t.text(d => d )\n\t\t\t\t.attr(\"font-size\", legend_font_size)\n\t\t\t\t.attr(\"font-weight\", \"bold\")\n\t\t\t\t.attr(\"text-anchor\", \"left\")\n\t\t\t\t.style(\"alignment-baseline\", \"middle\")\n\t\t\t\t.style(\"fill\", d => color(d) )\n\t\t\t\t.call(el => el.attr(\"x\", (d,i) =>{\n\t\t\t\t  let x = margin.left + parseFloat(legend_font_size)/2 + 3;\n\t\t\t\t  if (i===1) x = svgWidth - margin.right - parseFloat(legend_font_size)/2 -  el.nodes()[1].getComputedTextLength() - 3\n\t\t\t\t  return x\n\t\t\t\t})\n\t\t\t\t), \n\t\t  update => update.call(el =>\n\t\t    el.transition().duration(transitionMillisec)\n\t\t      .attr(\"y\", margin.top/2)\n\t\t      .attr(\"font-size\", legend_font_size)\n\t\t      .attr(\"x\", (d,i) =>{\n\t\t\tlet x = margin.left + parseFloat(legend_font_size)/2 + 3;\n\t\t\tif (i===1) x = svgWidth - margin.right - parseFloat(legend_font_size)/2 - el.nodes()[1].getComputedTextLength() - 3;\n\t\t\treturn x\n\t\t      })\n\t\t  )\n\t\t)\n    })\n\n\n    // create / update active-area\n    useEffect(() => {\n      const svgElement = d3.select(svgRef.current);\n      \n      const active_area = d3.area()\n\t\t\t    .x(d => xScale(d[0]))\n\t\t\t    .y0(active_yScale(0))\n\t\t\t    .y1(d => active_yScale(d[3]));\n\n      svgElement.select(\".active-area\").selectAll(\"path\")\n\t\t.data([data]) // Array with 1 element keyed by index, so enters once then only updates\n\t\t.join(\n\t\t  enter => enter.append(\"path\")\n\t\t\t\t.classed(styles.area, true)\n\t\t\t\t.attr(\"d\", (d) => active_area(d))\n\t\t\t\t.attr(\"fill\", activeColor)\n\t\t\t\t.attr(\"fill-opacity\", 0.3)\n\t\t\t\t.attr(\"opacity\", 0)\n\t\t\t\t.call(el => el.transition().duration(transitionMillisec).attr(\"opacity\", 1)),\n\t\t  update => update\n                    .attr(\"opacity\", 0)\n                    .call(el =>\n                      el.transition().duration(transitionMillisec)\n                        .attr(\"d\", (d) => active_area(d))\n\t\t\t.attr(\"opacity\",1)\n                    ),\n\t\t);\n    })\n\n    // create / update active-line\n    useEffect(() => {\n      const svgElement = d3.select(svgRef.current);\n      \n      const active_line = d3.line()\n\t\t\t .x(d => xScale(d[0]))\n\t\t\t .y(d => active_yScale(d[3]));\n      \n      svgElement.select(\".active-line\").selectAll(\"path\")\n\t\t.data([data]) // Array with 1 element keyed by index, so enters once then only updates\n\t\t.join(\n\t\t  enter => enter.append(\"path\")\n\t\t\t\t.classed(styles.line, true)\n\t\t\t\t.attr(\"d\", (d) => active_line(d))\n\t\t\t\t.attr(\"stroke\", activeColor)\n\t\t\t\t.attr(\"stroke-width\", 2)\n\t\t\t\t.attr(\"fill\", \"none\")\n\t\t\t\t.attr(\"opacity\", 0)\n\t\t\t\t.call(el => el.transition().duration(transitionMillisec).attr(\"opacity\", 1)),\n\t\t  update => update\n                    .attr(\"opacity\", 0)\n                    .call(el =>\n                      el.transition().duration(transitionMillisec)\n                        .attr(\"d\", (d) => active_line(d))\n                        .attr(\"opacity\", 1)\n                    ),\n\t\t);\n    })\n\n    // create / update pos-line\n    useEffect(() => {\n      const svgElement = d3.select(svgRef.current);\n\t\n      const pos_line = d3.line()\n\t\t\t .x(d => xScale(d[0]))\n\t\t\t .y(d => pos_yScale(d[1]));\n\t\n      svgElement.select(\".pos-line\").selectAll(\"path\")\n\t\t.data([data]) // Array with 1 element keyed by index, so enters once then only updates\n\t\t.join(\n\t\t  enter => enter.append(\"path\")\n\t\t\t\t.classed(styles.line, true)\n\t\t\t\t.attr(\"d\", (d) => pos_line(d))\n\t\t\t\t.attr(\"stroke\", posColor)\n\t\t\t\t.attr(\"stroke-width\", 2)\n\t\t\t\t.attr(\"fill\", \"none\")\n\t\t\t\t.attr(\"opacity\", 0)\n\t\t\t\t.call(el => el.transition().duration(transitionMillisec).attr(\"opacity\", 1)),\n\t\t  update => update\n                   .attr(\"opacity\", 0)\n                   .call(el =>\n                     el.transition().duration(transitionMillisec)\n                       .attr(\"d\", (d) => pos_line(d))\n                       .attr(\"opacity\", 1)\n                   ),\n\t\t);\n    })\n\n    // Hook to create / update active-circles\n    useEffect(() => {\n      const svgElement = d3.select(svgRef.current);\n      let tooltip = d3.select(\".tooltip\");\n\t\n      svgElement.select(\".active-circles\").selectAll(\"circle\")\n\t\t.data(data)\n\t\t.join(\n\t\t  enter => (\n\t\t    enter.append(\"circle\")\n\t\t      // Bind each circle to [x,y] coordinate\n\t\t\t .classed(\"circle\", true)\n\t\t\t .attr(\"cx\", (d) => xScale(d[0]))\n\t\t\t .attr(\"cy\", (d) => active_yScale(d[3]))\n\t\t\t .attr(\"fill\", activeColor)\n\t\t\t .attr(\"r\", 0)\n\t\t      // Transition from invisible to visible circle\n\t\t\t .call(el => el.transition().duration(transitionMillisec).attr(\"r\", circleRadius))\n\t\t      // Add d3 mouseover to display and move tooltip around\n\t\t\t .on(\"mouseover\", (d) => {\n\t\t\t   tooltip.html(tooltipHtml(d));\n\t\t\t   let tooltipLeft = d3.event.pageX > svgWidth/2 ? d3.event.pageX - parseFloat(tooltip.style('width')) : d3.event.pageX;\n\t\t\t   let tooltipTop = d3.event.pageY > svgHeight/2 ? d3.event.pageY - parseFloat(tooltip.style('height')) : d3.event.pageY;\n\t\t\t   tooltip.style(\"left\", `${tooltipLeft}px` ).style(\"top\", `${tooltipTop}px`);\n\t\t\t   tooltip.classed(\"hide\", false);\n\t\t\t   tooltip.classed(\"show\", true);\n\t\t\t })\n\t\t\t .on(\"mouseout\", (d) => {\n\t\t\t   tooltip.classed(\"show\", false);\n\t\t\t   tooltip.classed(\"hide\", true);\n\t\t\t })\n\t\t  ),\n\t\t  update => update.call(el =>\n\t\t    // If circle has not changed coordinates, maybe data scale changed\n\t\t    // so transition from original position to new position\n\t\t    el.transition().duration(transitionMillisec)\n\t\t      .attr(\"cx\", (d) => xScale(d[0]))\n\t\t      .attr(\"cy\", (d) => active_yScale(d[3]))\n\t\t      // NB : keep radius value, it seems in Streamlit lifecycle there are 2 renders when mounting ?\n\t\t\t\t\t    // so circles enter and during transition to full radius rerender\n\t\t    // so if r < circleRadius while update then animation breaks and circle stay small for first render\n\t\t      .attr(\"r\", circleRadius)\n\t\t      .attr(\"fill\", activeColor)\n\t\t  ),\n\t\t  exit => (\n\t\t    // Close tooltip and remove mouse events\n\t\t    exit.dispatch(\"mouseout\")\n\t\t\t.on(\"mouseover\", null)\n\t\t\t.on(\"mouseout\", null)\n\t\t      // Transition from visible to invisible circle then remove entirely\n\t\t\t.call(el =>\n\t\t\t  el.transition().duration(transitionMillisec / 2)\n\t\t\t    .attr(\"r\", 0)\n\t\t\t    .attr(\"fill\", activeColor)\n\t\t\t    .style(\"opacity\", 0)\n\t\t\t    .remove()\n\t\t\t)\n\t\t  ),\n\t\t)\n    })\n\n    // Hook to create / update pos-circles\n    useEffect(() => {\n      const svgElement = d3.select(svgRef.current);\n      let tooltip = d3.select(\".tooltip\");\n\n      svgElement.select(\".pos-circles\").selectAll(\"circle\")\n\t\t.data(data)\n\t\t.join(\n\t\t  enter => (\n\t\t    enter.append(\"circle\")\n                      // Bind each circle to [x,y] coordinate\n\t\t\t .classed(\"circle\", true)\n\t\t\t .attr(\"cx\", (d) => xScale(d[0]))\n\t\t\t .attr(\"cy\", (d) => pos_yScale(d[1]))\n\t\t\t .attr(\"fill\", posColor)\n\t\t\t .attr(\"r\", 0)\n                      // Transition from invisible to visible circle\n\t\t\t .call(el => el.transition().duration(transitionMillisec).attr(\"r\", circleRadius))\n                      // Add d3 mouseover to display and move tooltip around\n\t\t\t .on(\"mouseover\", (d) => {\n\t\t\t   let tooltipLeft = d3.event.pageX > svgWidth/2 ? d3.event.pageX - parseFloat(tooltip.style('width')) : d3.event.pageX;\n\t\t\t   let tooltipTop = d3.event.pageY > svgHeight/2 ? d3.event.pageY - parseFloat(tooltip.style('height')) : d3.event.pageY;\n\t\t\t   tooltip.style(\"left\", `${tooltipLeft}px` ).style(\"top\", `${tooltipTop}px`);\n\t\t\t   tooltip.html(tooltipHtml(d));\n\t\t\t   tooltip.classed(\"hide\", false);\n\t\t\t   tooltip.classed(\"show\", true);\n\t\t\t })\n\t\t\t .on(\"mouseout\", (d) => {\n\t\t\t   tooltip.classed(\"show\", false);\n\t\t\t   tooltip.classed(\"hide\", true);\n\t\t\t })\n\t\t  ),\n\t\t  update => update.call(el =>\n\t\t    // If circle has not changed coordinates, maybe data scale changed\n\t\t    // so transition from original position to new position\n\t\t    el.transition().duration(transitionMillisec)\n\t\t      .attr(\"cx\", (d) => xScale(d[0]))\n                      .attr(\"cy\", (d) => pos_yScale(d[1]))\n                      // NB : keep radius value, it seems in Streamlit lifecycle there are 2 renders when mounting ?\n                      // so circles enter and during transition to full radius rerender\n                      // so if r < circleRadius while update then animation breaks and circle stay small for first render\n                      .attr(\"r\", circleRadius)\n                      .attr(\"fill\", posColor)\n\t\t  ),\n\t\t  exit => (\n\t\t    // Close tooltip and remove mouse events\n\t\t    exit.dispatch(\"mouseout\")\n\t\t\t.on(\"mouseover\", null)\n\t\t\t.on(\"mouseout\", null)\n                      // Transition from visible to invisible circle then remove entirely\n\t\t\t.call(el =>\n\t\t\t  el.transition().duration(transitionMillisec / 2)\n                            .attr(\"r\", 0)\n                            .attr(\"fill\", posColor)\n                            .style(\"opacity\", 0)\n                            .remove()\n\t\t\t)\n\t\t  ),\n\t\t)\n    })\n\n    return (\n      <div className=\"timechart-container\">\n\t<div className='tooltip hide' />\n\t<svg className=\"timechart-svg\" ref={svgRef}  />\n      </div>\n    )\n    \n}\n\n// Build D3 scales from data\nconst buildScales = (data, svgWidth, svgHeight, margin) => {\n  \n  const xScale = d3.scaleTime()\n\t\t   .domain(d3.extent(data, (d) => d[0]))\n\t\t   .range([margin.left, svgWidth - margin.right]);\n  const pos_yScale = d3.scaleLinear()\n\t\t       .domain([0, d3.max(data, (d) => d[1])])\n\t\t       .range([svgHeight - margin.bottom, margin.top]);\n  const active_yScale = d3.scaleLinear()\n\t\t\t  .domain([0, d3.max(data, (d) => d[3])])\n\t\t\t  .range([svgHeight - margin.bottom, margin.top]);\n\n  return [xScale, pos_yScale, active_yScale]\n}\n\n// Format helpers\nconst formatDate = d3.timeFormat(\"%m/%d/%y\");\nconst formatPercent = d3.format(\".2%\");\n\n // Get client's window dimensions\nfunction get_client_dimensions() {\n  let clientsWidth = 0, clientsHeight = 0;\n  if( typeof( window.innerWidth ) == 'number' ) {\n    //Non-IE\n    clientsWidth = window.innerWidth;\n    clientsHeight = window.innerHeight;\n  } else if( document.documentElement && ( document.documentElement.clientWidth || document.documentElement.clientHeight ) ) {\n    //IE 6+ in 'standards compliant mode'\n    clientsWidth = document.documentElement.clientWidth;\n    clientsHeight = document.documentElement.clientHeight;\n  } else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) {\n    //IE 4 compatible\n    clientsWidth = document.body.clientWidth;\n    clientsHeight = document.body.clientHeight;\n  }\n  return {'width':clientsWidth, 'height': clientsHeight };\n}\n\n// Export component  \nexport default withStreamlitConnection(TimeChart)\n","import React from \"react\"\nimport ReactDOM from \"react-dom\"\nimport TimeChart from \"./TimeChart\"\n\nimport \"./index.css\"\n\nReactDOM.render(\n  <React.StrictMode>\n    <TimeChart />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n)\n"],"sourceRoot":""}