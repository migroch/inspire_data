{"version":3,"sources":["AreaChart.jsx","index.jsx"],"names":["formatTooltip","d3","formatDate","bisectDate","d","date","left","buildScales","data","total","svgWidth","svgHeight","margin","domain","range","right","bottom","top","get_client_dimensions","clientsWidth","clientsHeight","window","innerWidth","innerHeight","document","documentElement","clientWidth","clientHeight","body","withStreamlitConnection","props","aspectRatio","dimensions","useState","width","setWidth","setHeight","Streamlit","setFrameHeight","axis_font_size","legend_font_size","circleRadius","parseFloat","groups","args","colors","JSON","parse","map","temp_d","Date","split","g","stackedData","keys","at","xScale","yScale","colorScale","svgRef","useRef","useEffect","current","style","addEventListener","svgElement","append","classed","forEach","toLowerCase","select","call","attr","transition","duration","ticks","tickFormat","tickSize","tickSizeOuter","selectAll","reverse","join","enter","i","parseInt","el","update","text","stacked_area","x","y0","y1","styles","area","key","tooltip","on","focus_el","g0_data","tooltip_data","pageX","y","pageY","x0","invert","d0","length","d1","j","values","html","total_thisdate","reduce","acc","renderToString","className","color","tooltip_html","tooltipLeft","tooltipTop","ref","ReactDOM","render","StrictMode","getElementById"],"mappings":"0SAwTMA,G,MAAgBC,IAAU,MAC1BC,EAAaD,IAAc,YAC3BE,EAAaF,KAAa,SAAAG,GAAC,OAAIA,EAAEC,QAAMC,KAGvCC,EAAc,SAACC,EAAMC,EAAOC,EAAUC,EAAWC,GAQtD,MAAO,CAPQX,MACbY,OAAOZ,IAAUO,GAAM,SAACJ,GAAD,OAAOA,EAAEC,SAChCS,MAAM,CAACF,EAAON,KAAMI,EAAWE,EAAOG,QACzBd,MACbY,OAAO,CAAC,EAAEJ,IACVK,MAAM,CAACH,EAAYC,EAAOI,OAAQJ,EAAOK,QAM5C,SAASC,IACR,IAAIC,EAAe,EAAGC,EAAgB,EAetC,MAdmC,iBAAvBC,OAAOC,YAElBH,EAAeE,OAAOC,WACtBF,EAAgBC,OAAOE,aACbC,SAASC,kBAAqBD,SAASC,gBAAgBC,aAAeF,SAASC,gBAAgBE,eAEzGR,EAAeK,SAASC,gBAAgBC,YACxCN,EAAgBI,SAASC,gBAAgBE,cAC/BH,SAASI,OAAUJ,SAASI,KAAKF,aAAeF,SAASI,KAAKD,gBAExER,EAAeK,SAASI,KAAKF,YAC7BN,EAAgBI,SAASI,KAAKD,cAGxB,CAAC,MAAQR,EAAc,OAAUC,GAI1BS,mBAnVG,SAACC,GAElB,IAAIC,EAAc,IACdC,EAAad,IACjB,EAA8Be,mBAASD,EAAWE,OAAlD,mBAAOxB,EAAP,KAAiByB,EAAjB,KACIzB,EAAW,MAAKqB,EAAc,KAClC,MAAgCE,mBAASF,EAAYrB,GAArD,mBAAOC,EAAP,KAAkByB,EAAlB,KAEAC,IAAUC,eAAe3B,GAGzB,IAAI4B,EAAc,UAAM,GAAG,EAAE7B,EAAS,IAApB,MACd8B,EAAgB,UAAM,GAAG,EAAE9B,EAAS,IAApB,MACf+B,EAAe,KAAM/B,EACtBE,EAAS,CAAC,IAAO,GAAI,OAAU,EAAE8B,WAAWH,GAAgB,GAAI,KAAQ,EAAEG,WAAWH,GAAgB,GAAI,MAAS,EAAEG,WAAWH,IAE7HI,EAASb,EAAMc,KAAKD,OAEpBnC,GADSsB,EAAMc,KAAKC,OACbC,KAAKC,MAAMjB,EAAMc,KAAKpC,MAAMwC,KAAI,SAAA5C,GAC5C,IAAI6C,EAAS,CAAC5C,KAAK,IAAI6C,KAAuB,iBAAV9C,EAAEC,KAAmBD,EAAEC,KAAK8C,MAAM,KAAK,GAAG,YAAc/C,EAAEC,OAE9F,OADAsC,EAAOK,KAAI,SAAAI,GAAC,OAAIH,EAAOG,GAAKhD,EAAEgD,MACvBH,MAIJI,EAAcpD,MAChBqD,KAAKX,EADW1C,CAEhBO,GACIC,EAAQ4C,EAAYE,IAAI,GAAGA,IAAI,GAAG,GACxC,EAAuBhD,EAAYC,EAAMC,EAAOC,EAAUC,EAAWC,GAArE,mBAAK4C,EAAL,KAAaC,EAAb,KACIC,EAAazD,MACfY,OAAO8B,GACP7B,MAAMgB,EAAMc,KAAKC,QAGbc,EAASC,iBAAO,MAiQnB,OA9OHC,qBAAU,WASTxB,IAAUC,eAAe3B,GACzBV,IAAU0D,EAAOG,SAASC,MAAM,SAAUpD,GAC1CU,OAAO2C,iBAAiB,UAVH,WACpB,IAAIjC,EAAc,IACdC,EAAad,IACjBiB,EAASH,EAAWE,OAChBxB,EAAW,MAAKqB,EAAc,KAClCK,EAAWL,EAAYrB,QAMtB,CAACA,EAAUC,IAGdkD,qBAAU,WACT,IAAMI,EAAahE,IAAU0D,EAAOG,SACpCG,EAAWC,OAAO,KAAKC,QAAQ,UAAU,GACzCF,EAAWC,OAAO,KAAKC,QAAQ,UAAU,GACzCF,EAAWC,OAAO,KAAKC,QAAQ,gBAAgB,GAC/CF,EAAWC,OAAO,KAAKC,QAAQ,UAAU,GACzCF,EAAWC,OAAO,QAAQC,QAAQ,OAAO,GACzCxB,EAAOyB,SAAQ,SAAAhB,GAAC,OAAIa,EAAWC,OAAO,KAAKC,QAAvB,UAAkCf,EAAEiB,cAAclB,MAAM,KAAK,GAA7D,WAAyE,QAC3F,IAGAU,qBAAU,WACZ,IAAMI,EAAahE,IAAU0D,EAAOG,SAqDlCG,EAAWK,OAAO,WAAWC,MAnDjB,SAACnB,GAAD,OAAOA,EAAEoB,KAAK,YAAP,uBAAoC7D,EAAYC,EAAOI,OAAvD,MACnByD,aAAaC,SAhDW,MAiDxBF,KAAK,OAAQ,cACbA,KAAK,YAAajC,GAClBgC,KAAKtE,IAAcuD,GAClBmB,MAAM1E,KACN2E,WAAW3E,IAAc,UACzB4E,SAAS,GACTC,cAAc,IAEfP,MAAK,SAAAnB,GAAC,OAAIA,EAAE2B,UAAU,QACrBhB,MAAM,cAAe,aAEtBQ,MAAK,SAAAnB,GAAC,OAAIA,EAAE2B,UAAU,QACrBP,KAAK,SAAU,SACfA,KAAK,eAAgB,GACrBA,KAAK,iBAAkB,MAExBD,MAAK,SAAAnB,GAAC,OAAIA,EAAE2B,UAAU,cACrBP,KAAK,SAAU,SACfA,KAAK,iBAAkB,GACvBA,KAAK,eAAgB,SA+BtBP,EAAWK,OAAO,WAAWC,MA5BjB,SAACnB,GAAD,OAAOA,EAAEoB,KAAK,YAAP,oBAAiC5D,EAAON,KAAxC,SACnBmE,aAAaC,SAxEW,MAyExBF,KAAK,OAAQ,cACbA,KAAK,YAAajC,GAClBgC,KAAKtE,IAAYwD,GAChBkB,MAAM,EAAE,OACRE,UAAU,GAAKnE,EAAWE,EAAOG,MAAQH,EAAON,OAChDwE,cAAc,IAEfP,MAAK,SAAAnB,GAAC,OAAIA,EAAE2B,UAAU,WACtBR,MAAK,SAAAnB,GAAC,OAAIA,EAAE2B,UAAU,QACrBP,KAAK,SAAU,SACfA,KAAK,eAAgB,GACrBA,KAAK,iBAAkB,MAExBD,MAAK,SAAAnB,GAAC,OAAIA,EAAE2B,UAAU,QACrBP,KAAK,SAAU,SACfA,KAAK,eAAgB,GACrBA,KAAK,iBAAkB,MAExBD,MAAK,SAAAnB,GAAC,OAAIA,EAAE2B,UAAU,cACrBP,KAAK,SAAU,SACfA,KAAK,eAAgB,GACrBA,KAAK,iBAAkB,KACvBA,KAAK,mBAAoB,gBAQ1BX,qBAAU,WACX,IAAMI,EAAahE,IAAU0D,EAAOG,SACpCnB,EAAOqC,UACPf,EAAWK,OAAO,WAAWS,UAAU,UACtCvE,KAAKmC,GACLsC,MACA,SAAAC,GAAK,OAAIA,EAAMhB,OAAO,UACpBM,KAAK,KAAM5D,EAAON,KAAO,IACzBkE,KAAK,MAAM,SAACpE,EAAE+E,GAAH,OAAiBvE,EAAOK,IAAI,GAAjB,EAAEkE,GAAoB,GAAO,GAAGA,KACtDX,KAAK,IAAKY,SAAS5C,GAAkB,GACrCuB,MAAM,QAAQ,SAAA3D,GAAC,OAAIsD,EAAWtD,MAC9BoE,KAAK,UAAW,GAChBD,MAAK,SAAAc,GAAE,OAAIA,EAAGZ,aAAaC,SAnHL,MAmHkCF,KAAK,UAAW,SAC1E,SAAAc,GAAM,OAAIA,EACRf,MAAK,SAAAc,GAAE,OAAIA,EAAGZ,aAAaC,SArHL,MAsHrBX,MAAM,QAAQ,SAAA3D,GAAC,OAAIsD,EAAWtD,MAC9BoE,KAAK,KAAM5D,EAAON,KAAO,IACzBkE,KAAK,MAAM,SAACpE,EAAE+E,GAAH,OAAiBvE,EAAOK,IAAI,GAAjB,EAAEkE,GAAoB,GAAO,GAAGA,KACtDX,KAAK,IAAK9B,WAAWF,GAAkB,GACvCgC,KAAK,UAAW,SAIrBP,EAAWK,OAAO,WAAWS,UAAU,QACrCvE,KAAKmC,GACLsC,MACA,SAAAC,GAAK,OAAIA,EAAMhB,OAAO,QACpBM,KAAK,IAAK5D,EAAON,KAAOoC,WAAWF,GAAkB,EAAI,IACzD+C,MAAK,SAAAnF,GAAC,OAAIA,KACVoE,KAAK,YAAahC,GAClBgC,KAAK,cAAe,QACpBA,KAAK,cAAe,QACpBT,MAAM,qBAAsB,UAC5BA,MAAM,QAAQ,SAAA3D,GAAC,OAAIsD,EAAWtD,MAC9BmE,MAAK,SAAAc,GAAE,OAAIA,EAAGb,KAAK,KAAK,SAACpE,EAAE+E,GAAH,OAAiBvE,EAAOK,IAAI,GAAjB,EAAEkE,GAAoB,GAAO,GAAGA,EAAK,WAC1E,SAAAG,GAAM,OAAIA,EAAOf,MAAK,SAAAc,GAAE,OAAIA,EAAGZ,aAAaC,SA1IpB,MA2ItBa,MAAK,SAAAnF,GAAC,OAAIA,KACV2D,MAAM,QAAQ,SAAA3D,GAAC,OAAIsD,EAAWtD,MAC9BoE,KAAK,IAAK5D,EAAON,KAAOoC,WAAWF,GAAkB,EAAI,IACzDgC,KAAK,YAAahC,GAClBgC,KAAK,KAAK,SAACpE,EAAE+E,GAAH,OAAiBvE,EAAOK,IAAI,GAAjB,EAAEkE,GAAoB,GAAO,GAAGA,EAAK,WAI7DxC,EAAOqC,aAINnB,qBAAU,WACZ,IAAMI,EAAahE,IAAU0D,EAAOG,SAE9B0B,EAAevF,MACnBwF,GAAE,SAACrF,GAAD,OAAOoD,EAAOpD,EAAEI,KAAKH,SACvBqF,IAAG,SAACtF,GAAD,OAAOqD,EAAOrD,EAAE,OACnBuF,IAAG,SAACvF,GAAD,OAAOqD,EAAOrD,EAAE,OAErB6D,EAAWK,OAAO,iBAAiBS,UAAU,QAC3CvE,KAAK6C,GACL4B,MACA,SAAAC,GAAK,OAAIA,EAAMhB,OAAO,QACpBC,QAAQyB,IAAOC,MAAM,GACrBrB,KAAK,KAAK,SAACpE,GAAD,OAAOoF,EAAapF,MAC9BoE,KAAK,QAAQ,SAASpE,GAAK,OAAOsD,EAAWtD,EAAE0F,QAC/CtB,KAAK,eAAgB,IACrBA,KAAK,UAAW,GAChBD,MAAK,SAAAc,GAAE,OAAIA,EAAGZ,aAAaC,SAxKL,MAyKrBF,KAAK,eAAgB,IACrBA,KAAK,UAAW,SAEnB,SAAAc,GAAM,OAAIA,EACRd,KAAK,QAAQ,SAASpE,GAAK,OAAOsD,EAAWtD,EAAE0F,QAChCtB,KAAK,eAAgB,IACpCA,KAAK,UAAW,GACDD,MAAK,SAAAc,GAAE,OAAIA,EAAGZ,aAAaC,SAhLpB,MAiLpBF,KAAK,KAAK,SAACpE,GAAD,OAAOoF,EAAapF,MAC9BoE,KAAK,eAAe,KACpBA,KAAK,UAAW,YAMvBX,qBAAU,WACT,IAAMI,EAAahE,IAAU0D,EAAOG,SAChCiC,EAAU9F,IAAU,YAExBgE,EAAWK,OAAO,QAChBE,KAAK,YADP,oBACiC5D,EAAON,KAAK,EAD7C,SAEEkE,KAAK,QAAS9D,EAAWE,EAAOG,MAAQH,EAAON,MAC/CkE,KAAK,SAAU7D,EAAYC,EAAOI,QAClCgF,GAAG,aAAa,WAChBrD,EAAOyB,SAAQ,SAAAhB,GACd,IAAI6C,EAAWhC,EAAWK,OAAX,WAAsBlB,EAAEiB,cAAclB,MAAM,KAAK,GAAjD,WACf8C,EAAS/B,OAAO,QAAQC,QAAQ,aAAa,GAC7C8B,EAAS/B,OAAO,UACdC,QAAQ,eAAe,GACvBK,KAAK,IAAK/B,GACV+B,KAAK,OAAQd,EAAWN,IAC1B6C,EAAS9B,QAAQ,QAAQ,GACzB8B,EAAS9B,QAAQ,QAAQ,SAG1B6B,GAAG,YAAY,WACfrD,EAAOyB,SAAQ,SAAAhB,GACd,IAAI6C,EAAWhC,EAAWK,OAAX,WAAsBlB,EAAEiB,cAAclB,MAAM,KAAK,GAAjD,WACf8C,EAAS9B,QAAQ,QAAQ,GACzB8B,EAAS9B,QAAQ,QAAQ,MAE1B4B,EAAQ5B,QAAQ,QAAQ,GACxB4B,EAAQ5B,QAAQ,QAAQ,MAExB6B,GAAG,aAAa,WAEhB,IAAIE,EAAU7C,EAAY,GAAGL,KAAI,SAAA5C,GAAC,OAAIA,EAAEI,QACpC2F,EAAe,GAGfV,EAAIxF,IAASmG,MAChBC,EAAIpG,IAASqG,MACbC,EAAK/C,EAAOgD,OAAOf,GACnBN,EAAIhF,EAAW+F,EAASK,GAKrBE,EAAKP,GAFTf,GADAA,EAAIA,EAAI,EAAI,EAAIA,GACRe,EAAQQ,OAAS,EAAIR,EAAQQ,OAAS,EAAIvB,GAE7B,GAAIwB,EAAKT,EAAQf,GACtCgB,EAAejG,EAAWqG,GAAMrG,EAAWuG,EAAGpG,MAAQH,EAAWyG,EAAGtG,MAAQH,EAAWqG,GAAMI,EAAKF,EACzF,GAALtB,IAAQgB,EAAeM,GACvBtB,GAAKe,EAAQQ,OAAS,IAAGP,EAAeQ,GAE5ChE,EAAOyB,SAAQ,SAAChB,EAAEwD,GACjB,IAAIX,EAAWhC,EAAWK,OAAX,WAAsBlB,EAAEiB,cAAclB,MAAM,KAAK,GAAjD,WACX9C,EAAO8F,EAAa9F,KACpBwG,EAASxD,EAAYuD,GAAGzB,GAC5Bc,EAAS3B,OAAO,gBACdE,KAAK,KAAMhB,EAAOnD,IAClBmE,KAAK,KAAMf,EAAOoD,EAAO,KAC3BZ,EAAS3B,OAAO,cACdE,KAAK,KAAMhB,EAAOnD,IAAOmE,KAAK,KAAMf,EAAOoD,EAAO,KAClDrC,KAAK,KAAMhB,EAAOnD,IAAOmE,KAAK,KAAMf,EAAOoD,EAAO,KAClDrC,KAAK,OAAQ,SACbA,KAAK,SAAU,YAGlBuB,EAAQe,KApPU,SAACX,GACrB,IAAIY,EAAiBpE,EAAOqE,QAAO,SAACC,EAAK7D,GAAN,OAAY6D,EAAMd,EAAa/C,KAAI,GAUtE,OATW8D,yBACV,yBAAKC,UAAU,YACd,oCAAS,gCAASjH,EAAWiG,EAAa9F,QAEzCsC,EAAOK,KAAI,SAAAI,GAAC,OAAI,uBAAG0C,IAAK1C,EAAGW,MAAO,CAACqD,MAAM1D,EAAWN,KAAMA,EAA1C,KAA8C,gCAASpD,EAAcmG,EAAa/C,SAEnG,uBAAGW,MAAO,CAACqD,MAdK,YAchB,UAAqC,gCAASpH,EAAc+G,OA4O/CM,CAAalB,IAC1B,IAAImB,EAAc7B,EAAI/E,EAAS,EAAI+E,EAAI/C,WAAWqD,EAAQhC,MAAM,UAAY,GAAK0B,EAAI,GACjF8B,EAAalB,EAAI1F,EAAU,EAAI0F,EAAI3D,WAAWqD,EAAQhC,MAAM,WAAasC,EAC7EN,EAAQhC,MAAM,OAAd,UAAyBuD,EAAzB,OAA2CvD,MAAM,MAAjD,UAA2DwD,EAA3D,OACAxB,EAAQ5B,QAAQ,QAAQ,GACxB4B,EAAQ5B,QAAQ,QAAQ,SAK1B,yBAAKgD,UAAU,uBACf,yBAAKA,UAAU,iBACf,yBAAKA,UAAU,gBAAgBK,IAAK7D,Q,MC3StC8D,IAASC,OACP,kBAAC,IAAMC,WAAP,KACE,kBAAC,EAAD,OAEFnG,SAASoG,eAAe,W","file":"static/js/main.c754f23f.chunk.js","sourcesContent":["import React, {useEffect, useState, useRef} from \"react\";\nimport {renderToString} from \"react-dom/server\";\nimport { Streamlit, withStreamlitConnection,} from \"streamlit-component-lib\";\nimport * as d3 from \"d3\";\n\nimport styles from './AreaChart.css';\nimport { svg } from \"d3\";\nimport { format } from \"path\";\n\n// Create AreaChart component\nconst AreaChart = (props) => {\n\n\tlet aspectRatio = 0.38\n\tlet dimensions = get_client_dimensions();\n\tconst [svgWidth, setWidth ] = useState(dimensions.width);\n\tif (svgWidth < 600) aspectRatio = 0.68\n\tconst [svgHeight, setHeight ] = useState(aspectRatio*svgWidth);\n\n\tStreamlit.setFrameHeight(svgHeight);\n\n\t//let label_font_size = \"15px\";\n\tlet axis_font_size = `${11+5*svgWidth/1000}px`;\n\tlet legend_font_size = `${11+5*svgWidth/1000}px`;\n\tlet  circleRadius = 0.003*svgWidth;\n\tlet margin = {\"top\": 10, \"bottom\": 4*parseFloat(axis_font_size)-10, \"left\": 2*parseFloat(axis_font_size)+30, \"right\": 3*parseFloat(axis_font_size)};\n\n\tconst groups = props.args.groups;\n\tconst colors = props.args.colors;\n\tconst data = JSON.parse(props.args.data).map(d => { \n\t\tlet temp_d = {date:new Date( typeof d.date == \"string\" ? d.date.split('T')[0]+'T12:00:00' : d.date )};\n\t\tgroups.map(g => temp_d[g] = d[g]);\n\t\treturn temp_d;\n\t});\n\n\t// Build scales, group & stack data, and set colors\n\tlet stackedData = d3.stack()\n\t\t.keys(groups)\n\t\t(data)\n\tconst total = stackedData.at(-1).at(-1)[1];\n\tlet [xScale, yScale] = buildScales(data, total, svgWidth, svgHeight, margin);\n\tlet colorScale = d3.scaleOrdinal()\n\t\t.domain(groups)\n\t\t.range(props.args.colors)\n\tconst totalColor = '#F77F00'\n\n\tconst svgRef = useRef(null);\n\tconst transitionMillisec = 1200;\n\n\t// Create tooltip html\n\tconst tooltip_html = (tooltip_data) => {\n\t\tlet total_thisdate = groups.reduce((acc, g) => acc + tooltip_data[g], 0);\n\t\tlet html = renderToString(\n\t\t\t<div className=\".tooltip\">\t\n\t\t\t\t<p>Date: <strong>{formatDate(tooltip_data.date)}</strong></p>\n\t\t\t\t{\n\t\t\t\t\tgroups.map(g => <p key={g} style={{color:colorScale(g)}}>{g}: <strong>{formatTooltip(tooltip_data[g])}</strong></p>)\n\t\t\t\t}\n\t\t\t\t<p style={{color:totalColor}}>Total: <strong>{formatTooltip(total_thisdate)}</strong></p>\n\t\t\t</div>\n\t\t)\n\t\treturn html;\n\t}\n\t\n\t// Set svgHeight and update it on window resize\n\tuseEffect(() => {\n\t\tconst handleResize = () => {\n\t\t\tlet aspectRatio = 0.38\n\t\t\tlet dimensions = get_client_dimensions();\n\t\t\tsetWidth(dimensions.width);\n\t\t\tif (svgWidth < 600) aspectRatio = 0.68;\n\t\t\tsetHeight( aspectRatio*svgWidth );\n\t\t}\n\t\t\n\t\tStreamlit.setFrameHeight(svgHeight);\n\t\td3.select(svgRef.current).style(\"height\", svgHeight);\n\t\twindow.addEventListener('resize', handleResize)\n\t}, [svgWidth, svgHeight])\n\n\t// On mount, create group containers\n\tuseEffect(() => {\n\t\tconst svgElement = d3.select(svgRef.current);\n\t\tsvgElement.append(\"g\").classed('x-axis', true);\n\t\tsvgElement.append(\"g\").classed('y-axis', true);\n\t\tsvgElement.append(\"g\").classed('stacked-area', true);\n\t\tsvgElement.append(\"g\").classed('legend', true);\n\t\tsvgElement.append(\"rect\").classed('box', true);\n\t\tgroups.forEach(g => svgElement.append(\"g\").classed(`${g.toLowerCase().split(' ')[0]}-focus`, true));\n\t}, [])\n\n    // Hook to create / update axis and grid\n    useEffect(() => {\n\t\tconst svgElement = d3.select(svgRef.current);\n\t\t\n\t\tconst xAxis = (g) => g.attr(\"transform\", `translate(0, ${svgHeight - margin.bottom})`)\n\t\t\t.transition().duration(transitionMillisec)\n\t\t\t.attr(\"font\", \"sans-serif\")\n\t\t\t.attr(\"font-size\", axis_font_size)\n\t\t\t.call(d3.axisBottom(xScale)\n\t\t\t\t.ticks(d3.timeMonth)\n\t\t\t\t.tickFormat(d3.timeFormat(\"%b %y\"))\n\t\t\t\t.tickSize(5)\n\t\t\t\t.tickSizeOuter(0)\n\t\t\t)\n\t\t\t.call(g => g.selectAll('text')\n\t\t\t\t.style(\"text-anchor\", \"middle\")\n\t\t\t)\n\t\t\t.call(g => g.selectAll(\"path\")\n\t\t\t\t.attr(\"stroke\", \"black\")\n\t\t\t\t.attr(\"stroke-width\", 1)\n\t\t\t\t.attr(\"stroke-opacity\", 1)\n\t\t\t)\n\t\t\t.call(g => g.selectAll(\".tick line\")\n\t\t\t\t.attr(\"stroke\", \"black\")\n\t\t\t\t.attr(\"stroke-opacity\", 1)\n\t\t\t\t.attr(\"stroke-width\", 1)\n\t\t\t);\n        \n\t\tconst yAxis = (g) => g.attr(\"transform\", `translate(${margin.left}, 0)`)\n\t\t\t.transition().duration(transitionMillisec)\n\t\t\t.attr(\"font\", \"sans-serif\")\n\t\t\t.attr(\"font-size\", axis_font_size)\n\t\t\t.call(d3.axisLeft(yScale)\n\t\t\t\t.ticks(8,\".0s\")\n\t\t\t\t.tickSize(-1 * (svgWidth - margin.right - margin.left))\n\t\t\t\t.tickSizeOuter(0)\n\t\t\t)\n\t\t\t.call(g => g.selectAll('text'))\n\t\t\t.call(g => g.selectAll(\"path\")\n\t\t\t\t.attr(\"stroke\", \"black\" )\n\t\t\t\t.attr(\"stroke-width\", 1)\n\t\t\t\t.attr(\"stroke-opacity\", 1)\n\t\t\t)\n\t\t\t.call(g => g.selectAll(\"line\")\n\t\t\t\t.attr(\"stroke\", \"black\")\n\t\t\t\t.attr(\"stroke-width\", 1)\n\t\t\t\t.attr(\"stroke-opacity\", 1)\n\t\t\t)\n\t\t\t.call(g => g.selectAll(\".tick line\")\n\t\t\t\t.attr(\"stroke\", \"black\")\n\t\t\t\t.attr(\"stroke-width\", 1)\n\t\t\t\t.attr(\"stroke-opacity\", 0.25)\n\t\t\t\t.attr(\"stroke-dasharray\", \"2,2\")\n\t\t\t);\n\n    svgElement.select(\".x-axis\").call(xAxis);\n    svgElement.select(\".y-axis\").call(yAxis);\n    })\n\n    // Hook to create / update legend\n    useEffect(() => {\n\t\t\tconst svgElement = d3.select(svgRef.current);\n\t\t\tgroups.reverse()\n\t\t\tsvgElement.select(\".legend\").selectAll(\"circle\")\n\t\t\t.data(groups)\t\n\t\t\t.join(\n\t\t\t\tenter => enter.append(\"circle\")\n\t\t\t\t\t.attr(\"cx\", margin.left + 20)\n\t\t\t\t\t.attr(\"cy\", (d,i) => ((1-i)*(margin.top/2) + 17) + (30*i))\n\t\t\t\t\t.attr(\"r\", parseInt(legend_font_size)/2)\n\t\t\t\t\t.style(\"fill\", d => colorScale(d))\n\t\t\t\t\t.attr(\"opacity\", 0)\n\t\t\t\t\t.call(el => el.transition().duration(transitionMillisec).attr(\"opacity\", 1)),\n\t\t\t\tupdate => update\n\t\t\t\t\t.call(el => el.transition().duration(transitionMillisec)\n\t\t\t\t\t\t.style(\"fill\", d => colorScale(d))\n\t\t\t\t\t\t.attr(\"cx\", margin.left + 20)\n\t\t\t\t\t\t.attr(\"cy\", (d,i) => ((1-i)*(margin.top/2) + 17) + (30*i))\n\t\t\t\t\t\t.attr(\"r\", parseFloat(legend_font_size)/2)\n\t\t\t\t\t\t.attr(\"opacity\", 1)\n\t\t\t\t\t)\n\t\t\t);\n\t\t\n\t\tsvgElement.select(\".legend\").selectAll(\"text\")\n\t\t\t.data(groups)\n\t\t\t.join(\n\t\t\t\tenter => enter.append(\"text\")\n\t\t\t\t\t.attr(\"x\", margin.left + parseFloat(legend_font_size)/2 + 25)\n\t\t\t\t\t.text(d => d )\n\t\t\t\t\t.attr(\"font-size\", legend_font_size)\n\t\t\t\t\t.attr(\"font-weight\", \"bold\")\n\t\t\t\t\t.attr(\"text-anchor\", \"left\")\n\t\t\t\t\t.style(\"alignment-baseline\", \"middle\")\n\t\t\t\t\t.style(\"fill\", d => colorScale(d) )\n\t\t\t\t\t.call(el => el.attr(\"y\", (d,i) => ((1-i)*(margin.top/2) + 17) + (30*i) + 1)), \n\t\t\t\tupdate => update.call(el => el.transition().duration(transitionMillisec)\n\t\t\t\t\t.text(d => d )\n\t\t\t\t\t.style(\"fill\", d => colorScale(d) )\n\t\t\t\t\t.attr(\"x\", margin.left + parseFloat(legend_font_size)/2 + 25)\n\t\t\t\t\t.attr(\"font-size\", legend_font_size)\n\t\t\t\t\t.attr(\"y\", (d,i) => ((1-i)*(margin.top/2) + 17) + (30*i) + 1)\n\t\t\t\t)\n\t\t\t);\n\n\t\t\tgroups.reverse();\n    })\n\n    // create / update stacked-area\n    useEffect(() => {\n\t\tconst svgElement = d3.select(svgRef.current);\n\n\t\tconst stacked_area = d3.area()\n\t\t\t.x((d) => xScale(d.data.date))\n\t\t\t.y0((d) => yScale(d[0]))\n\t\t\t.y1((d) => yScale(d[1]));\n\n\t\tsvgElement.select(\".stacked-area\").selectAll(\"path\")\n\t\t\t.data(stackedData) // Array with 1 element keyed by index, so enters once then only updates\n\t\t\t.join(\n\t\t\t\tenter => enter.append(\"path\")\n\t\t\t\t\t.classed(styles.area, true)\n\t\t\t\t\t.attr(\"d\", (d) => stacked_area(d))\n\t\t\t\t\t.attr(\"fill\", function(d) { return colorScale(d.key); })\n\t\t\t\t\t.attr(\"fill-opacity\", 0.3)\n\t\t\t\t\t.attr(\"opacity\", 0)\n\t\t\t\t\t.call(el => el.transition().duration(transitionMillisec)\n\t\t\t\t\t\t.attr(\"fill-opacity\", 0.7)\n\t\t\t\t\t\t.attr(\"opacity\", 1)\n\t\t\t\t\t),\n\t\t\t\tupdate => update\n\t\t\t\t\t.attr(\"fill\", function(d) { return colorScale(d.key); })\n                    .attr(\"fill-opacity\", 0.3)\n\t\t\t\t\t.attr(\"opacity\", 0)\n                    .call(el => el.transition().duration(transitionMillisec)\n\t\t\t\t\t\t\t.attr(\"d\", (d) => stacked_area(d))\n\t\t\t\t\t\t\t.attr(\"fill-opacity\",0.75)\n\t\t\t\t\t\t\t.attr(\"opacity\", 1)\n                    ),\n\t\t\t);\n    })\n\n\t// Hook to create / update tooltip and foci\n\tuseEffect(() => {\n\t\tconst svgElement = d3.select(svgRef.current);\n\t\tlet tooltip = d3.select(\".tooltip\");\n\n\t\tsvgElement.select(\".box\")\n\t\t\t.attr(\"transform\", `translate(${margin.left+1}, 0)`)\n\t\t\t.attr(\"width\", svgWidth - margin.right - margin.left)\n\t\t\t.attr(\"height\", svgHeight - margin.bottom)\n\t\t\t.on(\"mouseover\", () => {\n\t\t\t\tgroups.forEach(g => {\n\t\t\t\t\tlet focus_el = svgElement.select(`.${g.toLowerCase().split(' ')[0]}-focus`)\n\t\t\t\t\tfocus_el.append(\"line\").classed(\"focusLine\", true);\n\t\t\t\t\tfocus_el.append(\"circle\")\n\t\t\t\t\t\t.classed(\"focusCircle\", true)\n\t\t\t\t\t\t.attr(\"r\", circleRadius)\n\t\t\t\t\t\t.attr(\"fill\", colorScale(g));\n\t\t\t\t\tfocus_el.classed(\"hide\", false);\n\t\t\t\t\tfocus_el.classed(\"show\", true);\n\t\t\t\t})\n\t\t\t})\n\t\t\t.on(\"mouseout\", () => {\n\t\t\t\tgroups.forEach(g => {\n\t\t\t\t\tlet focus_el = svgElement.select(`.${g.toLowerCase().split(' ')[0]}-focus`)\t\t\t\t\t\t\t\n\t\t\t\t\tfocus_el.classed(\"show\", false);\n\t\t\t\t\tfocus_el.classed(\"hide\", true);\n\t\t\t\t})\n\t\t\t\ttooltip.classed(\"show\", false);\n\t\t\t\ttooltip.classed(\"hide\", true);\n\t\t\t})\n\t\t\t.on(\"mousemove\", () => {\n\t\t\t\t// Get date and group values data from the first group in stackedData \n\t\t\t\tlet g0_data = stackedData[0].map(d => d.data); \n\t\t\t\tlet tooltip_data = {};\n\n\t\t\t\t// get mouse x and y position\n\t\t\t\tlet x = d3.event.pageX,\n\t\t\t\t\ty = d3.event.pageY,\n\t\t\t\t\tx0 = xScale.invert(x),\n\t\t\t\t\ti = bisectDate(g0_data, x0);\n\n\t\t\t\ti = i < 0 ? 0 : i;\n\t\t\t\ti = i > g0_data.length - 1 ? g0_data.length - 1 : i;\n\n\t\t\t\tlet d0 = g0_data[i - 1], d1 = g0_data[i]\n\t\t\t\ttooltip_data = formatDate(x0) - formatDate(d0.date) > formatDate(d1.date) - formatDate(x0) ? d1 : d0;\t\n\t\t\t\tif (i == 0) tooltip_data = d0;\n\t\t\t\tif (i == g0_data.length - 1) tooltip_data = d1;\n\t\t\t\t\t\t\t\n\t\t\t\tgroups.forEach((g,j) => {\n\t\t\t\t\tlet focus_el = svgElement.select(`.${g.toLowerCase().split(' ')[0]}-focus`);\n\t\t\t\t\tlet date = tooltip_data.date;\n\t\t\t\t\tlet values = stackedData[j][i];\n\t\t\t\t\tfocus_el.select(\".focusCircle\")\n\t\t\t\t\t\t.attr(\"cx\", xScale(date))\n\t\t\t\t\t\t.attr(\"cy\", yScale(values[1]));\n\t\t\t\t\tfocus_el.select(\".focusLine\")\n\t\t\t\t\t\t.attr(\"x1\", xScale(date)).attr(\"y1\", yScale(values[0]))\n\t\t\t\t\t\t.attr(\"x2\", xScale(date)).attr(\"y2\", yScale(values[1]))\n\t\t\t\t\t\t.attr(\"fill\", 'black')\n\t\t\t\t\t\t.attr(\"stroke\", 'black');\t\t\t\t\t\n\t\t\t\t});\n\n\t\t\t\ttooltip.html(tooltip_html(tooltip_data))\n\t\t\t\tlet tooltipLeft = x > svgWidth/2 ? x - parseFloat(tooltip.style('width')) - 10 : x + 10;\n\t\t\t\tlet tooltipTop = y > svgHeight/2 ? y - parseFloat(tooltip.style('height')) : y;\n\t\t\t\ttooltip.style(\"left\", `${tooltipLeft}px` ).style(\"top\", `${tooltipTop}px`);\n\t\t\t\ttooltip.classed(\"hide\", false);\n\t\t\t\ttooltip.classed(\"show\", true);\n\t\t\t})\n\t});\n\n    return (\n\t\t<div className=\"areachart-container\">\n\t\t<div className='tooltip hide' />\n\t\t<svg className=\"areachart-svg\" ref={svgRef}  />\n\t\t</div>\n    )   \n}\n\n\n// Format helpers\nconst formatTooltip = d3.format(',');\nconst formatDate = d3.timeFormat(\"%m/%d/%y\");\nconst bisectDate = d3.bisector( d => d.date).left;\n\n// Build D3 scales from data\nconst buildScales = (data, total, svgWidth, svgHeight, margin) => {\n\tconst xScale = d3.scaleTime()\n\t\t.domain(d3.extent(data, (d) => d.date))\n\t\t.range([margin.left, svgWidth - margin.right]);\n\tconst yScale = d3.scaleLinear()\n\t\t.domain([0,total])\n\t\t.range([svgHeight - margin.bottom, margin.top]);\n\n\treturn [xScale, yScale]\n}\n\n// Get client's window dimensions\nfunction get_client_dimensions() {\n\tlet clientsWidth = 0, clientsHeight = 0;\n\tif( typeof( window.innerWidth ) == 'number' ) {\n\t\t//Non-IE\n\t\tclientsWidth = window.innerWidth;\n\t\tclientsHeight = window.innerHeight;\n\t} else if( document.documentElement && ( document.documentElement.clientWidth || document.documentElement.clientHeight ) ) {\n    \t//IE 6+ in 'standards compliant mode'\n\t\tclientsWidth = document.documentElement.clientWidth;\n\t\tclientsHeight = document.documentElement.clientHeight;\n\t} else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) {\n\t\t//IE 4 compatible\n\t\tclientsWidth = document.body.clientWidth;\n\t\tclientsHeight = document.body.clientHeight;\n\t}\n\n\treturn {'width':clientsWidth, 'height': clientsHeight };\n}\n\n// Export component  \nexport default withStreamlitConnection(AreaChart)","import React from \"react\"\nimport ReactDOM from \"react-dom\"\nimport AreaChart from \"./AreaChart\"\n\nimport \"./index.css\"\n\nReactDOM.render(\n  <React.StrictMode>\n    <AreaChart />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n)\n"],"sourceRoot":""}